import defaultValue from"../../Core/defaultValue.js";import defined from"../../Core/defined.js";import DeveloperError from"../../Core/DeveloperError.js";import EllipsoidTerrainProvider from"../../Core/EllipsoidTerrainProvider.js";import knockout from"../../ThirdParty/knockout.js";import createCommand from"../createCommand.js";function BaseLayerPickerViewModel(e){var r=(e=defaultValue(e,defaultValue.EMPTY_OBJECT)).globe,i=defaultValue(e.imageryProviderViewModels,[]),o=defaultValue(e.terrainProviderViewModels,[]);if(!defined(r))throw new DeveloperError("globe is required");this._globe=r,this.imageryProviderViewModels=i.slice(0),this.terrainProviderViewModels=o.slice(0),this.dropDownVisible=!1,knockout.track(this,["imageryProviderViewModels","terrainProviderViewModels","dropDownVisible"]);var t=knockout.getObservable(this,"imageryProviderViewModels"),d=knockout.pureComputed((function(){var e,r=t(),i={};for(e=0;e<r.length;e++){var o=r[e],d=o.category;defined(i[d])?i[d].push(o):i[d]=[o]}var n=Object.keys(i),a=[];for(e=0;e<n.length;e++){var s=n[e];a.push({name:s,providers:i[s]})}return a}));this._imageryProviders=d;var n=knockout.getObservable(this,"terrainProviderViewModels"),a=knockout.pureComputed((function(){var e,r=n(),i={};for(e=0;e<r.length;e++){var o=r[e],t=o.category;defined(i[t])?i[t].push(o):i[t]=[o]}var d=Object.keys(i),a=[];for(e=0;e<d.length;e++){var s=d[e];a.push({name:s,providers:i[s]})}return a}));this._terrainProviders=a,this.buttonTooltip=void 0,knockout.defineProperty(this,"buttonTooltip",(function(){var e=this.selectedImagery,r=this.selectedTerrain,i=defined(e)?e.name:void 0,o=defined(r)?r.name:void 0;return defined(i)&&defined(o)?i+"\n"+o:defined(i)?i:o})),this.buttonImageUrl=void 0,knockout.defineProperty(this,"buttonImageUrl",(function(){var e=this.selectedImagery;if(defined(e))return e.iconUrl})),this.selectedImagery=void 0;var s=knockout.observable();this._currentImageryProviders=[],knockout.defineProperty(this,"selectedImagery",{get:function(){return s()},set:function(e){if(s()!==e){var r,i=this._currentImageryProviders,o=i.length,t=this._globe.imageryLayers,d=!1;for(r=0;r<o;r++)for(var n=t.length,a=0;a<n;a++){var l=t.get(a);if(l.imageryProvider===i[r]){t.remove(l),d=!0;break}}if(defined(e)){var u=e.creationCommand();if(Array.isArray(u)){for(r=u.length-1;r>=0;r--)t.addImageryProvider(u[r],0);this._currentImageryProviders=u.slice(0)}else if(this._currentImageryProviders=[u],d)t.addImageryProvider(u,0);else{var v=t.get(0);defined(v)&&t.remove(v),t.addImageryProvider(u,0)}}s(e),this.dropDownVisible=!1}else this.dropDownVisible=!1}}),this.selectedTerrain=void 0;var l=knockout.observable();knockout.defineProperty(this,"selectedTerrain",{get:function(){return l()},set:function(e){var r;l()!==e?(defined(e)&&(r=e.creationCommand()),this._globe.depthTestAgainstTerrain=!(r instanceof EllipsoidTerrainProvider),this._globe.terrainProvider=r,l(e),this.dropDownVisible=!1):this.dropDownVisible=!1}});var u=this;this._toggleDropDown=createCommand((function(){u.dropDownVisible=!u.dropDownVisible})),this.selectedImagery=defaultValue(e.selectedImageryProviderViewModel,i[0]),this.selectedTerrain=defaultValue(e.selectedTerrainProviderViewModel,o[0])}Object.defineProperties(BaseLayerPickerViewModel.prototype,{toggleDropDown:{get:function(){return this._toggleDropDown}},globe:{get:function(){return this._globe}}});export default BaseLayerPickerViewModel;