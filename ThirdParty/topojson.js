function identity(r){return r}function transform(r){if(null==r)return identity;var e,t,n=r.scale[0],o=r.scale[1],a=r.translate[0],c=r.translate[1];return function(r,i){i||(e=t=0);var u=2,s=r.length,f=new Array(s);for(f[0]=(e+=r[0])*n+a,f[1]=(t+=r[1])*o+c;u<s;)f[u]=r[u],++u;return f}}function bbox(r){var e,t=transform(r.transform),n=1/0,o=n,a=-n,c=-n;function i(r){(r=t(r))[0]<n&&(n=r[0]),r[0]>a&&(a=r[0]),r[1]<o&&(o=r[1]),r[1]>c&&(c=r[1])}function u(r){switch(r.type){case"GeometryCollection":r.geometries.forEach(u);break;case"Point":i(r.coordinates);break;case"MultiPoint":r.coordinates.forEach(i)}}for(e in r.arcs.forEach((function(r){for(var e,i=-1,u=r.length;++i<u;)(e=t(r[i],i))[0]<n&&(n=e[0]),e[0]>a&&(a=e[0]),e[1]<o&&(o=e[1]),e[1]>c&&(c=e[1])})),r.objects)u(r.objects[e]);return[n,o,a,c]}function reverse(r,e){for(var t,n=r.length,o=n-e;o<--n;)t=r[o],r[o++]=r[n],r[n]=t}function feature(r,e){return"string"==typeof e&&(e=r.objects[e]),"GeometryCollection"===e.type?{type:"FeatureCollection",features:e.geometries.map((function(e){return feature$1(r,e)}))}:feature$1(r,e)}function feature$1(r,e){var t=e.id,n=e.bbox,o=null==e.properties?{}:e.properties,a=object(r,e);return null==t&&null==n?{type:"Feature",properties:o,geometry:a}:null==n?{type:"Feature",id:t,properties:o,geometry:a}:{type:"Feature",id:t,bbox:n,properties:o,geometry:a}}function object(r,e){var t=transform(r.transform),n=r.arcs;function o(r,e){e.length&&e.pop();for(var o=n[r<0?~r:r],a=0,c=o.length;a<c;++a)e.push(t(o[a],a));r<0&&reverse(e,c)}function a(r){return t(r)}function c(r){for(var e=[],t=0,n=r.length;t<n;++t)o(r[t],e);return e.length<2&&e.push(e[0]),e}function i(r){for(var e=c(r);e.length<4;)e.push(e[0]);return e}function u(r){return r.map(i)}return function r(e){var t,n=e.type;switch(n){case"GeometryCollection":return{type:n,geometries:e.geometries.map(r)};case"Point":t=a(e.coordinates);break;case"MultiPoint":t=e.coordinates.map(a);break;case"LineString":t=c(e.arcs);break;case"MultiLineString":t=e.arcs.map(c);break;case"Polygon":t=u(e.arcs);break;case"MultiPolygon":t=e.arcs.map(u);break;default:return null}return{type:n,coordinates:t}}(e)}function stitch(r,e){var t={},n={},o={},a=[],c=-1;function i(r,e){for(var n in r){var o=r[n];delete e[o.start],delete o.start,delete o.end,o.forEach((function(r){t[r<0?~r:r]=1})),a.push(o)}}return e.forEach((function(t,n){var o,a=r.arcs[t<0?~t:t];a.length<3&&!a[1][0]&&!a[1][1]&&(o=e[++c],e[c]=t,e[n]=o)})),e.forEach((function(e){var t,a,c=function(e){var t,n=r.arcs[e<0?~e:e],o=n[0];return r.transform?(t=[0,0],n.forEach((function(r){t[0]+=r[0],t[1]+=r[1]}))):t=n[n.length-1],e<0?[t,o]:[o,t]}(e),i=c[0],u=c[1];if(t=o[i])if(delete o[t.end],t.push(e),t.end=u,a=n[u]){delete n[a.start];var s=a===t?t:t.concat(a);n[s.start=t.start]=o[s.end=a.end]=s}else n[t.start]=o[t.end]=t;else if(t=n[u])if(delete n[t.start],t.unshift(e),t.start=i,a=o[i]){delete o[a.end];var f=a===t?t:a.concat(t);n[f.start=a.start]=o[f.end=t.end]=f}else n[t.start]=o[t.end]=t;else n[(t=[e]).start=i]=o[t.end=u]=t})),i(o,n),i(n,o),e.forEach((function(r){t[r<0?~r:r]||a.push([r])})),a}function mesh(r){return object(r,meshArcs.apply(this,arguments))}function meshArcs(r,e,t){var n,o,a;if(arguments.length>1)n=extractArcs(r,e,t);else for(o=0,n=new Array(a=r.arcs.length);o<a;++o)n[o]=o;return{type:"MultiLineString",arcs:stitch(r,n)}}function extractArcs(r,e,t){var n,o=[],a=[];function c(r){var e=r<0?~r:r;(a[e]||(a[e]=[])).push({i:r,g:n})}function i(r){r.forEach(c)}function u(r){r.forEach(i)}return function r(e){switch(n=e,e.type){case"GeometryCollection":e.geometries.forEach(r);break;case"LineString":i(e.arcs);break;case"MultiLineString":case"Polygon":u(e.arcs);break;case"MultiPolygon":!function(r){r.forEach(u)}(e.arcs)}}(e),a.forEach(null==t?function(r){o.push(r[0].i)}:function(r){t(r[0].g,r[r.length-1].g)&&o.push(r[0].i)}),o}function planarRingArea(r){for(var e,t=-1,n=r.length,o=r[n-1],a=0;++t<n;)e=o,o=r[t],a+=e[0]*o[1]-e[1]*o[0];return Math.abs(a)}function merge(r){return object(r,mergeArcs.apply(this,arguments))}function mergeArcs(r,e){var t={},n=[],o=[];function a(r){r.forEach((function(e){e.forEach((function(e){(t[e=e<0?~e:e]||(t[e]=[])).push(r)}))})),n.push(r)}function c(e){return planarRingArea(object(r,{type:"Polygon",arcs:[e]}).coordinates[0])}return e.forEach((function r(e){switch(e.type){case"GeometryCollection":e.geometries.forEach(r);break;case"Polygon":a(e.arcs);break;case"MultiPolygon":e.arcs.forEach(a)}})),n.forEach((function(r){if(!r._){var e=[],n=[r];for(r._=1,o.push(e);r=n.pop();)e.push(r),r.forEach((function(r){r.forEach((function(r){t[r<0?~r:r].forEach((function(r){r._||(r._=1,n.push(r))}))}))}))}})),n.forEach((function(r){delete r._})),{type:"MultiPolygon",arcs:o.map((function(e){var n,o=[];if(e.forEach((function(r){r.forEach((function(r){r.forEach((function(r){t[r<0?~r:r].length<2&&o.push(r)}))}))})),(n=(o=stitch(r,o)).length)>1)for(var a,i,u=1,s=c(o[0]);u<n;++u)(a=c(o[u]))>s&&(i=o[0],o[0]=o[u],o[u]=i,s=a);return o})).filter((function(r){return r.length>0}))}}function bisect(r,e){for(var t=0,n=r.length;t<n;){var o=t+n>>>1;r[o]<e?t=o+1:n=o}return t}function neighbors(r){var e={},t=r.map((function(){return[]}));function n(r,t){r.forEach((function(r){r<0&&(r=~r);var n=e[r];n?n.push(t):e[r]=[t]}))}function o(r,e){r.forEach((function(r){n(r,e)}))}var a={LineString:n,MultiLineString:o,Polygon:o,MultiPolygon:function(r,e){r.forEach((function(r){o(r,e)}))}};for(var c in r.forEach((function r(e,t){"GeometryCollection"===e.type?e.geometries.forEach((function(e){r(e,t)})):e.type in a&&a[e.type](e.arcs,t)})),e)for(var i=e[c],u=i.length,s=0;s<u;++s)for(var f=s+1;f<u;++f){var l,h=i[s],p=i[f];(l=t[h])[c=bisect(l,p)]!==p&&l.splice(c,0,p),(l=t[p])[c=bisect(l,h)]!==h&&l.splice(c,0,h)}return t}function untransform(r){if(null==r)return identity;var e,t,n=r.scale[0],o=r.scale[1],a=r.translate[0],c=r.translate[1];return function(r,i){i||(e=t=0);var u=2,s=r.length,f=new Array(s),l=Math.round((r[0]-a)/n),h=Math.round((r[1]-c)/o);for(f[0]=l-e,e=l,f[1]=h-t,t=h;u<s;)f[u]=r[u],++u;return f}}function quantize(r,e){if(r.transform)throw new Error("already quantized");if(e&&e.scale)i=r.bbox;else{if(!((t=Math.floor(e))>=2))throw new Error("n must be â‰¥2");var t,n=(i=r.bbox||bbox(r))[0],o=i[1],a=i[2],c=i[3];e={scale:[a-n?(a-n)/(t-1):1,c-o?(c-o)/(t-1):1],translate:[n,o]}}var i,u,s=untransform(e),f=r.objects,l={};function h(r){return s(r)}function p(r){var e;switch(r.type){case"GeometryCollection":e={type:"GeometryCollection",geometries:r.geometries.map(p)};break;case"Point":e={type:"Point",coordinates:h(r.coordinates)};break;case"MultiPoint":e={type:"MultiPoint",coordinates:r.coordinates.map(h)};break;default:return r}return null!=r.id&&(e.id=r.id),null!=r.bbox&&(e.bbox=r.bbox),null!=r.properties&&(e.properties=r.properties),e}for(u in f)l[u]=p(f[u]);return{type:"Topology",bbox:i,transform:e,objects:l,arcs:r.arcs.map((function(r){var e,t=0,n=1,o=r.length,a=new Array(o);for(a[0]=s(r[0],0);++t<o;)((e=s(r[t],t))[0]||e[1])&&(a[n++]=e);return 1===n&&(a[n++]=[0,0]),a.length=n,a}))}}var index=Object.freeze({__proto__:null,bbox:bbox,feature:feature,mesh:mesh,meshArcs:meshArcs,merge:merge,mergeArcs:mergeArcs,neighbors:neighbors,quantize:quantize,transform:transform,untransform:untransform});export{index as default};