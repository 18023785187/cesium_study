import buildModuleUrl from"./buildModuleUrl.js";import Color from"./Color.js";import defined from"./defined.js";import DeveloperError from"./DeveloperError.js";import Resource from"./Resource.js";import writeTextToCanvas from"./writeTextToCanvas.js";function PinBuilder(){this._cache={}}PinBuilder.prototype.fromColor=function(e,r){if(!defined(e))throw new DeveloperError("color is required");if(!defined(r))throw new DeveloperError("size is required");return createPin(void 0,void 0,e,r,this._cache)},PinBuilder.prototype.fromUrl=function(e,r,i){if(!defined(e))throw new DeveloperError("url is required");if(!defined(r))throw new DeveloperError("color is required");if(!defined(i))throw new DeveloperError("size is required");return createPin(e,void 0,r,i,this._cache)},PinBuilder.prototype.fromMakiIconId=function(e,r,i){if(!defined(e))throw new DeveloperError("id is required");if(!defined(r))throw new DeveloperError("color is required");if(!defined(i))throw new DeveloperError("size is required");return createPin(buildModuleUrl("Assets/Textures/maki/"+encodeURIComponent(e)+".png"),void 0,r,i,this._cache)},PinBuilder.prototype.fromText=function(e,r,i){if(!defined(e))throw new DeveloperError("text is required");if(!defined(r))throw new DeveloperError("color is required");if(!defined(i))throw new DeveloperError("size is required");return createPin(void 0,e,r,i,this._cache)};var colorScratch=new Color;function drawPin(e,r,i){e.save(),e.scale(i/24,i/24),e.fillStyle=r.toCssColorString(),e.strokeStyle=r.brighten(.6,colorScratch).toCssColorString(),e.lineWidth=.846,e.beginPath(),e.moveTo(6.72,.422),e.lineTo(17.28,.422),e.bezierCurveTo(18.553,.422,19.577,1.758,19.577,3.415),e.lineTo(19.577,10.973),e.bezierCurveTo(19.577,12.63,18.553,13.966,17.282,13.966),e.lineTo(14.386,14.008),e.lineTo(11.826,23.578),e.lineTo(9.614,14.008),e.lineTo(6.719,13.965),e.bezierCurveTo(5.446,13.983,4.422,12.629,4.422,10.972),e.lineTo(4.422,3.416),e.bezierCurveTo(4.423,1.76,5.447,.423,6.718,.423),e.closePath(),e.fill(),e.stroke(),e.restore()}function drawIcon(e,r,i){var o=i/2.5,t=o,n=o;r.width>r.height?n=o*(r.height/r.width):r.width<r.height&&(t=o*(r.width/r.height));var d=Math.round((i-t)/2),l=Math.round(7/24*i-n/2);e.globalCompositeOperation="destination-out",e.drawImage(r,d-1,l,t,n),e.drawImage(r,d,l-1,t,n),e.drawImage(r,d+1,l,t,n),e.drawImage(r,d,l+1,t,n),e.globalCompositeOperation="destination-over",e.fillStyle=Color.BLACK.toCssColorString(),e.fillRect(d-1,l-1,t+2,n+2),e.globalCompositeOperation="destination-out",e.drawImage(r,d,l,t,n),e.globalCompositeOperation="destination-over",e.fillStyle=Color.WHITE.toCssColorString(),e.fillRect(d-1,l-2,t+2,n+2)}var stringifyScratch=new Array(4);function createPin(e,r,i,o,t){stringifyScratch[0]=e,stringifyScratch[1]=r,stringifyScratch[2]=i,stringifyScratch[3]=o;var n=JSON.stringify(stringifyScratch),d=t[n];if(defined(d))return d;var l=document.createElement("canvas");l.width=o,l.height=o;var a=l.getContext("2d");if(drawPin(a,i,o),defined(e)){var s=Resource.createIfNeeded(e).fetchImage().then((function(e){return drawIcon(a,e,o),t[n]=l,l}));return t[n]=s,s}if(defined(r)){var f=writeTextToCanvas(r,{font:"bold "+o+"px sans-serif"});drawIcon(a,f,o)}return t[n]=l,l}export default PinBuilder;