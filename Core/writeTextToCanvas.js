import Color from"./Color.js";import defaultValue from"./defaultValue.js";import defined from"./defined.js";import DeveloperError from"./DeveloperError.js";function measureText(e,t,i,o,a){var l=e.measureText(t);if(/\S/.test(t)){var n=document.defaultView.getComputedStyle(e.canvas).getPropertyValue("font-size").replace("px",""),d=document.createElement("canvas"),r=l.width+100|0,m=3*n,f=m/2;d.width=r,d.height=m;var h=d.getContext("2d");h.font=i,h.fillStyle="white",h.fillRect(0,0,d.width+1,d.height+1),o&&(h.strokeStyle="black",h.lineWidth=e.lineWidth,h.strokeText(t,50,f)),a&&(h.fillStyle="black",h.fillText(t,50,f));var g,s,u,S,b=h.getImageData(0,0,r,m).data,E=b.length,c=4*r;for(g=0;g<E;++g)if(255!==b[g]){u=g/c|0;break}for(g=E-1;g>=0;--g)if(255!==b[g]){S=g/c|0;break}var v=-1;for(g=0;g<r&&-1===v;++g)for(s=0;s<m;++s){var C=4*g+s*c;if(255!==b[C]||255!==b[C+1]||255!==b[C+2]||255!==b[C+3]){v=g;break}}return{width:l.width,height:S-u,ascent:f-u,descent:S-f,minx:v-50}}return{width:l.width,height:0,ascent:0,descent:0,minx:0}}var imageSmoothingEnabledName;function writeTextToCanvas(e,t){if(!defined(e))throw new DeveloperError("text is required.");if(""!==e){t=defaultValue(t,defaultValue.EMPTY_OBJECT);var i=defaultValue(t.font,"10px sans-serif"),o=defaultValue(t.stroke,!1),a=defaultValue(t.fill,!0),l=defaultValue(t.strokeWidth,1),n=defaultValue(t.backgroundColor,Color.TRANSPARENT),d=defaultValue(t.padding,0),r=2*d,m=document.createElement("canvas");m.width=1,m.height=1,m.style.font=i;var f=m.getContext("2d");defined(imageSmoothingEnabledName)||(defined(f.imageSmoothingEnabled)?imageSmoothingEnabledName="imageSmoothingEnabled":defined(f.mozImageSmoothingEnabled)?imageSmoothingEnabledName="mozImageSmoothingEnabled":defined(f.webkitImageSmoothingEnabled)?imageSmoothingEnabledName="webkitImageSmoothingEnabled":defined(f.msImageSmoothingEnabled)&&(imageSmoothingEnabledName="msImageSmoothingEnabled")),f.font=i,f.lineJoin="round",f.lineWidth=l,f[imageSmoothingEnabledName]=!1,m.style.visibility="hidden",document.body.appendChild(m);var h=measureText(f,e,i,o,a);m.dimensions=h,document.body.removeChild(m),m.style.visibility="";var g=-h.minx,s=Math.ceil(h.width)+g+r,u=h.height+r,S=u-(u-h.ascent+d)+r;if(m.width=s,m.height=u,f.font=i,f.lineJoin="round",f.lineWidth=l,f[imageSmoothingEnabledName]=!1,n!==Color.TRANSPARENT&&(f.fillStyle=n.toCssColorString(),f.fillRect(0,0,m.width,m.height)),o){var b=defaultValue(t.strokeColor,Color.BLACK);f.strokeStyle=b.toCssColorString(),f.strokeText(e,g+d,S)}if(a){var E=defaultValue(t.fillColor,Color.WHITE);f.fillStyle=E.toCssColorString(),f.fillText(e,g+d,S)}return m}}export default writeTextToCanvas;