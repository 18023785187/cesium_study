import ApproximateTerrainHeights from"./ApproximateTerrainHeights.js";import ArcType from"./ArcType.js";import arrayRemoveDuplicates from"./arrayRemoveDuplicates.js";import BoundingSphere from"./BoundingSphere.js";import Cartesian3 from"./Cartesian3.js";import Cartographic from"./Cartographic.js";import Check from"./Check.js";import ComponentDatatype from"./ComponentDatatype.js";import defaultValue from"./defaultValue.js";import defined from"./defined.js";import DeveloperError from"./DeveloperError.js";import Ellipsoid from"./Ellipsoid.js";import EllipsoidGeodesic from"./EllipsoidGeodesic.js";import EllipsoidRhumbLine from"./EllipsoidRhumbLine.js";import EncodedCartesian3 from"./EncodedCartesian3.js";import GeographicProjection from"./GeographicProjection.js";import Geometry from"./Geometry.js";import GeometryAttribute from"./GeometryAttribute.js";import IntersectionTests from"./IntersectionTests.js";import CesiumMath from"./Math.js";import Matrix3 from"./Matrix3.js";import Plane from"./Plane.js";import Quaternion from"./Quaternion.js";import Rectangle from"./Rectangle.js";import WebMercatorProjection from"./WebMercatorProjection.js";var PROJECTIONS=[GeographicProjection,WebMercatorProjection],PROJECTION_COUNT=PROJECTIONS.length,MITER_BREAK_SMALL=Math.cos(CesiumMath.toRadians(30)),MITER_BREAK_LARGE=Math.cos(CesiumMath.toRadians(150)),WALL_INITIAL_MIN_HEIGHT=0,WALL_INITIAL_MAX_HEIGHT=1e3;function GroundPolylineGeometry(t){var a=(t=defaultValue(t,defaultValue.EMPTY_OBJECT)).positions;if(!defined(a)||a.length<2)throw new DeveloperError("At least two positions are required.");if(defined(t.arcType)&&t.arcType!==ArcType.GEODESIC&&t.arcType!==ArcType.RHUMB)throw new DeveloperError("Valid options for arcType are ArcType.GEODESIC and ArcType.RHUMB.");this.width=defaultValue(t.width,1),this._positions=a,this.granularity=defaultValue(t.granularity,9999),this.loop=defaultValue(t.loop,!1),this.arcType=defaultValue(t.arcType,ArcType.GEODESIC),this._ellipsoid=Ellipsoid.WGS84,this._projectionIndex=0,this._workerName="createGroundPolylineGeometry",this._scene3DOnly=!1}Object.defineProperties(GroundPolylineGeometry.prototype,{packedLength:{get:function(){return 1+3*this._positions.length+1+1+1+Ellipsoid.packedLength+1+1}}}),GroundPolylineGeometry.setProjectionAndEllipsoid=function(t,a){for(var e=0,r=0;r<PROJECTION_COUNT;r++)if(a instanceof PROJECTIONS[r]){e=r;break}t._projectionIndex=e,t._ellipsoid=a.ellipsoid};var cart3Scratch1=new Cartesian3,cart3Scratch2=new Cartesian3,cart3Scratch3=new Cartesian3;function computeRightNormal(t,a,e,r,n){var i=getPosition(r,t,0,cart3Scratch1),o=getPosition(r,t,e,cart3Scratch2),c=getPosition(r,a,0,cart3Scratch3),s=direction(o,i,cart3Scratch2),h=direction(c,i,cart3Scratch3);return Cartesian3.cross(h,s,n),Cartesian3.normalize(n,n)}var interpolatedCartographicScratch=new Cartographic,interpolatedBottomScratch=new Cartesian3,interpolatedTopScratch=new Cartesian3,interpolatedNormalScratch=new Cartesian3;function interpolateSegment(t,a,e,r,n,i,o,c,s,h,l){if(0!==n){var p;i===ArcType.GEODESIC?p=new EllipsoidGeodesic(t,a,o):i===ArcType.RHUMB&&(p=new EllipsoidRhumbLine(t,a,o));var m=p.surfaceDistance;if(!(m<n))for(var C=computeRightNormal(t,a,r,o,interpolatedNormalScratch),u=Math.ceil(m/n),d=m/u,g=d,S=u-1,E=c.length,f=0;f<S;f++){var y=p.interpolateUsingSurfaceDistance(g,interpolatedCartographicScratch),N=getPosition(o,y,e,interpolatedBottomScratch),w=getPosition(o,y,r,interpolatedTopScratch);Cartesian3.pack(C,c,E),Cartesian3.pack(N,s,E),Cartesian3.pack(w,h,E),l.push(y.latitude),l.push(y.longitude),E+=3,g+=d}}}var heightlessCartographicScratch=new Cartographic;function getPosition(t,a,e,r){return Cartographic.clone(a,heightlessCartographicScratch),heightlessCartographicScratch.height=e,Cartographic.toCartesian(heightlessCartographicScratch,t,r)}function direction(t,a,e){return Cartesian3.subtract(t,a,e),Cartesian3.normalize(e,e),e}function tangentDirection(t,a,e,r){return r=direction(t,a,r),r=Cartesian3.cross(r,e,r),r=Cartesian3.normalize(r,r),Cartesian3.cross(e,r,r)}GroundPolylineGeometry.pack=function(t,a,e){Check.typeOf.object("value",t),Check.defined("array",a);var r=defaultValue(e,0),n=t._positions,i=n.length;a[r++]=i;for(var o=0;o<i;++o){var c=n[o];Cartesian3.pack(c,a,r),r+=3}return a[r++]=t.granularity,a[r++]=t.loop?1:0,a[r++]=t.arcType,Ellipsoid.pack(t._ellipsoid,a,r),r+=Ellipsoid.packedLength,a[r++]=t._projectionIndex,a[r++]=t._scene3DOnly?1:0,a},GroundPolylineGeometry.unpack=function(t,a,e){Check.defined("array",t);for(var r=defaultValue(a,0),n=t[r++],i=new Array(n),o=0;o<n;o++)i[o]=Cartesian3.unpack(t,r),r+=3;var c=t[r++],s=1===t[r++],h=t[r++],l=Ellipsoid.unpack(t,r);r+=Ellipsoid.packedLength;var p=t[r++],m=1===t[r++];return defined(e)||(e=new GroundPolylineGeometry({positions:i})),e._positions=i,e.granularity=c,e.loop=s,e.arcType=h,e._ellipsoid=l,e._projectionIndex=p,e._scene3DOnly=m,e};var toPreviousScratch=new Cartesian3,toNextScratch=new Cartesian3,forwardScratch=new Cartesian3,vertexUpScratch=new Cartesian3,cosine90=0,cosine180=-1;function computeVertexMiterNormal(t,a,e,r,n){var i=direction(e,a,vertexUpScratch),o=tangentDirection(t,a,i,toPreviousScratch),c=tangentDirection(r,a,i,toNextScratch);if(CesiumMath.equalsEpsilon(Cartesian3.dot(o,c),cosine180,CesiumMath.EPSILON5))return n=Cartesian3.cross(i,o,n),Cartesian3.normalize(n,n);n=Cartesian3.add(c,o,n),n=Cartesian3.normalize(n,n);var s=Cartesian3.cross(i,n,forwardScratch);return Cartesian3.dot(c,s)<cosine90&&(n=Cartesian3.negate(n,n)),n}var XZ_PLANE=Plane.fromPointNormal(Cartesian3.ZERO,Cartesian3.UNIT_Y),previousBottomScratch=new Cartesian3,vertexBottomScratch=new Cartesian3,vertexTopScratch=new Cartesian3,nextBottomScratch=new Cartesian3,vertexNormalScratch=new Cartesian3,intersectionScratch=new Cartesian3,cartographicScratch0=new Cartographic,cartographicScratch1=new Cartographic,cartographicIntersectionScratch=new Cartographic;GroundPolylineGeometry.createGeometry=function(t){var a,e,r,n,i,o,c=!t._scene3DOnly,s=t.loop,h=t._ellipsoid,l=t.granularity,p=t.arcType,m=new PROJECTIONS[t._projectionIndex](h),C=WALL_INITIAL_MIN_HEIGHT,u=WALL_INITIAL_MAX_HEIGHT,d=t._positions,g=d.length;2===g&&(s=!1);var S,E,f,y=new EllipsoidRhumbLine(void 0,void 0,h),N=[d[0]];for(e=0;e<g-1;e++)r=d[e],n=d[e+1],S=IntersectionTests.lineSegmentPlane(r,n,XZ_PLANE,intersectionScratch),!defined(S)||Cartesian3.equalsEpsilon(S,r,CesiumMath.EPSILON7)||Cartesian3.equalsEpsilon(S,n,CesiumMath.EPSILON7)||(t.arcType===ArcType.GEODESIC?N.push(Cartesian3.clone(S)):t.arcType===ArcType.RHUMB&&(f=h.cartesianToCartographic(S,cartographicScratch0).longitude,i=h.cartesianToCartographic(r,cartographicScratch0),o=h.cartesianToCartographic(n,cartographicScratch1),y.setEndPoints(i,o),E=y.findIntersectionWithLongitude(f,cartographicIntersectionScratch),S=h.cartographicToCartesian(E,intersectionScratch),!defined(S)||Cartesian3.equalsEpsilon(S,r,CesiumMath.EPSILON7)||Cartesian3.equalsEpsilon(S,n,CesiumMath.EPSILON7)||N.push(Cartesian3.clone(S)))),N.push(n);s&&(r=d[g-1],n=d[0],S=IntersectionTests.lineSegmentPlane(r,n,XZ_PLANE,intersectionScratch),!defined(S)||Cartesian3.equalsEpsilon(S,r,CesiumMath.EPSILON7)||Cartesian3.equalsEpsilon(S,n,CesiumMath.EPSILON7)||(t.arcType===ArcType.GEODESIC?N.push(Cartesian3.clone(S)):t.arcType===ArcType.RHUMB&&(f=h.cartesianToCartographic(S,cartographicScratch0).longitude,i=h.cartesianToCartographic(r,cartographicScratch0),o=h.cartesianToCartographic(n,cartographicScratch1),y.setEndPoints(i,o),E=y.findIntersectionWithLongitude(f,cartographicIntersectionScratch),S=h.cartographicToCartesian(E,intersectionScratch),!defined(S)||Cartesian3.equalsEpsilon(S,r,CesiumMath.EPSILON7)||Cartesian3.equalsEpsilon(S,n,CesiumMath.EPSILON7)||N.push(Cartesian3.clone(S)))));var w=N.length,T=new Array(w);for(e=0;e<w;e++){var v=Cartographic.fromCartesian(N[e],h);v.height=0,T[e]=v}if(!((w=(T=arrayRemoveDuplicates(T,Cartographic.equalsEpsilon)).length)<2)){var I=[],A=[],P=[],M=[],_=previousBottomScratch,L=vertexBottomScratch,j=vertexTopScratch,O=nextBottomScratch,D=vertexNormalScratch,G=T[0],R=T[1];for(_=getPosition(h,T[w-1],C,_),O=getPosition(h,R,C,O),L=getPosition(h,G,C,L),j=getPosition(h,G,u,j),D=s?computeVertexMiterNormal(_,L,j,O,D):computeRightNormal(G,R,u,h,D),Cartesian3.pack(D,A,0),Cartesian3.pack(L,P,0),Cartesian3.pack(j,M,0),I.push(G.latitude),I.push(G.longitude),interpolateSegment(G,R,C,u,l,p,h,A,P,M,I),e=1;e<w-1;++e){_=Cartesian3.clone(L,_),L=Cartesian3.clone(O,L);var k=T[e];getPosition(h,k,u,j),getPosition(h,T[e+1],C,O),computeVertexMiterNormal(_,L,j,O,D),a=A.length,Cartesian3.pack(D,A,a),Cartesian3.pack(L,P,a),Cartesian3.pack(j,M,a),I.push(k.latitude),I.push(k.longitude),interpolateSegment(T[e],T[e+1],C,u,l,p,h,A,P,M,I)}var x=T[w-1],B=T[w-2];if(L=getPosition(h,x,C,L),j=getPosition(h,x,u,j),s){var H=T[0];D=computeVertexMiterNormal(_=getPosition(h,B,C,_),L,j,O=getPosition(h,H,C,O),D)}else D=computeRightNormal(B,x,u,h,D);if(a=A.length,Cartesian3.pack(D,A,a),Cartesian3.pack(L,P,a),Cartesian3.pack(j,M,a),I.push(x.latitude),I.push(x.longitude),s){for(interpolateSegment(x,G,C,u,l,p,h,A,P,M,I),a=A.length,e=0;e<3;++e)A[a+e]=A[e],P[a+e]=P[e],M[a+e]=M[e];I.push(G.latitude),I.push(G.longitude)}return generateGeometryAttributes(s,m,P,M,A,I,c)}};var lineDirectionScratch=new Cartesian3,matrix3Scratch=new Matrix3,quaternionScratch=new Quaternion;function breakMiter(t,a,e,r){var n=direction(e,a,lineDirectionScratch),i=Cartesian3.dot(n,t);if(i>MITER_BREAK_SMALL||i<MITER_BREAK_LARGE){var o=direction(r,e,vertexUpScratch),c=i<MITER_BREAK_LARGE?CesiumMath.PI_OVER_TWO:-CesiumMath.PI_OVER_TWO,s=Quaternion.fromAxisAngle(o,c,quaternionScratch),h=Matrix3.fromQuaternion(s,matrix3Scratch);return Matrix3.multiplyByVector(h,t,t),!0}return!1}var endPosCartographicScratch=new Cartographic,normalStartpointScratch=new Cartesian3,normalEndpointScratch=new Cartesian3;function projectNormal(t,a,e,r,n){var i=Cartographic.toCartesian(a,t._ellipsoid,normalStartpointScratch),o=Cartesian3.add(i,e,normalEndpointScratch),c=!1,s=t._ellipsoid,h=s.cartesianToCartographic(o,endPosCartographicScratch);Math.abs(a.longitude-h.longitude)>CesiumMath.PI_OVER_TWO&&(c=!0,o=Cartesian3.subtract(i,e,normalEndpointScratch),h=s.cartesianToCartographic(o,endPosCartographicScratch)),h.height=0;var l=t.project(h,n);return(n=Cartesian3.subtract(l,r,n)).z=0,n=Cartesian3.normalize(n,n),c&&Cartesian3.negate(n,n),n}var adjustHeightNormalScratch=new Cartesian3,adjustHeightOffsetScratch=new Cartesian3;function adjustHeights(t,a,e,r,n,i){var o=Cartesian3.subtract(a,t,adjustHeightNormalScratch);Cartesian3.normalize(o,o);var c=e-WALL_INITIAL_MIN_HEIGHT,s=Cartesian3.multiplyByScalar(o,c,adjustHeightOffsetScratch);Cartesian3.add(t,s,n);var h=r-WALL_INITIAL_MAX_HEIGHT;s=Cartesian3.multiplyByScalar(o,h,adjustHeightOffsetScratch),Cartesian3.add(a,s,i)}var nudgeDirectionScratch=new Cartesian3;function nudgeXZ(t,a){var e=Plane.getPointDistance(XZ_PLANE,t),r=Plane.getPointDistance(XZ_PLANE,a),n=nudgeDirectionScratch;CesiumMath.equalsEpsilon(e,0,CesiumMath.EPSILON2)?(n=direction(a,t,n),Cartesian3.multiplyByScalar(n,CesiumMath.EPSILON2,n),Cartesian3.add(t,n,t)):CesiumMath.equalsEpsilon(r,0,CesiumMath.EPSILON2)&&(n=direction(t,a,n),Cartesian3.multiplyByScalar(n,CesiumMath.EPSILON2,n),Cartesian3.add(a,n,a))}function nudgeCartographic(t,a){var e=Math.abs(t.longitude),r=Math.abs(a.longitude);if(CesiumMath.equalsEpsilon(e,CesiumMath.PI,CesiumMath.EPSILON11)){var n=CesiumMath.sign(a.longitude);return t.longitude=n*(e-CesiumMath.EPSILON11),1}if(CesiumMath.equalsEpsilon(r,CesiumMath.PI,CesiumMath.EPSILON11)){var i=CesiumMath.sign(t.longitude);return a.longitude=i*(r-CesiumMath.EPSILON11),2}return 0}var startCartographicScratch=new Cartographic,endCartographicScratch=new Cartographic,segmentStartTopScratch=new Cartesian3,segmentEndTopScratch=new Cartesian3,segmentStartBottomScratch=new Cartesian3,segmentEndBottomScratch=new Cartesian3,segmentStartNormalScratch=new Cartesian3,segmentEndNormalScratch=new Cartesian3,getHeightCartographics=[startCartographicScratch,endCartographicScratch],getHeightRectangleScratch=new Rectangle,adjustHeightStartTopScratch=new Cartesian3,adjustHeightEndTopScratch=new Cartesian3,adjustHeightStartBottomScratch=new Cartesian3,adjustHeightEndBottomScratch=new Cartesian3,segmentStart2DScratch=new Cartesian3,segmentEnd2DScratch=new Cartesian3,segmentStartNormal2DScratch=new Cartesian3,segmentEndNormal2DScratch=new Cartesian3,offsetScratch=new Cartesian3,startUpScratch=new Cartesian3,endUpScratch=new Cartesian3,rightScratch=new Cartesian3,startPlaneNormalScratch=new Cartesian3,endPlaneNormalScratch=new Cartesian3,encodeScratch=new EncodedCartesian3,encodeScratch2D=new EncodedCartesian3,forwardOffset2DScratch=new Cartesian3,right2DScratch=new Cartesian3,normalNudgeScratch=new Cartesian3,scratchBoundingSpheres=[new BoundingSphere,new BoundingSphere],REFERENCE_INDICES=[0,2,1,0,3,2,0,7,3,0,4,7,0,5,4,0,1,5,5,7,4,5,6,7,5,2,6,5,1,2,3,6,2,3,7,6],REFERENCE_INDICES_LENGTH=REFERENCE_INDICES.length;function generateGeometryAttributes(t,a,e,r,n,i,o){var c,s,h,l,p,m,C=a._ellipsoid,u=e.length/3-1,d=8*u,g=4*d,S=36*u,E=d>65535?new Uint32Array(S):new Uint16Array(S),f=new Float64Array(3*d),y=new Float32Array(g),N=new Float32Array(g),w=new Float32Array(g),T=new Float32Array(g),v=new Float32Array(g);o&&(h=new Float32Array(g),l=new Float32Array(g),p=new Float32Array(g),m=new Float32Array(2*d));var I=i.length/2,A=0,P=startCartographicScratch;P.height=0;var M=endCartographicScratch;M.height=0;var _=segmentStartTopScratch,L=segmentEndTopScratch;if(o)for(s=0,c=1;c<I;c++)P.latitude=i[s],P.longitude=i[s+1],M.latitude=i[s+2],M.longitude=i[s+3],_=a.project(P,_),L=a.project(M,L),A+=Cartesian3.distance(_,L),s+=2;var j=r.length/3;L=Cartesian3.unpack(r,0,L);var O,D=0;for(s=3,c=1;c<j;c++)_=Cartesian3.clone(L,_),L=Cartesian3.unpack(r,s,L),D+=Cartesian3.distance(_,L),s+=3;s=3;var G=0,R=0,k=0,x=0,B=!1,H=Cartesian3.unpack(e,0,segmentEndBottomScratch),b=Cartesian3.unpack(r,0,segmentEndTopScratch),V=Cartesian3.unpack(n,0,segmentEndNormalScratch);t&&breakMiter(V,Cartesian3.unpack(e,e.length-6,segmentStartBottomScratch),H,b)&&(V=Cartesian3.negate(V,V));var z=0,F=0,U=0;for(c=0;c<u;c++){var q,W,X,Z,J=Cartesian3.clone(H,segmentStartBottomScratch),K=Cartesian3.clone(b,segmentStartTopScratch),Q=Cartesian3.clone(V,segmentStartNormalScratch);if(B&&(Q=Cartesian3.negate(Q,Q)),H=Cartesian3.unpack(e,s,segmentEndBottomScratch),b=Cartesian3.unpack(r,s,segmentEndTopScratch),B=breakMiter(V=Cartesian3.unpack(n,s,segmentEndNormalScratch),J,H,b),P.latitude=i[G],P.longitude=i[G+1],M.latitude=i[G+2],M.longitude=i[G+3],o){var Y=nudgeCartographic(P,M);q=a.project(P,segmentStart2DScratch);var $=direction(W=a.project(M,segmentEnd2DScratch),q,forwardOffset2DScratch);$.y=Math.abs($.y),X=segmentStartNormal2DScratch,Z=segmentEndNormal2DScratch,0===Y||Cartesian3.dot($,Cartesian3.UNIT_Y)>MITER_BREAK_SMALL?(X=projectNormal(a,P,Q,q,segmentStartNormal2DScratch),Z=projectNormal(a,M,V,W,segmentEndNormal2DScratch)):1===Y?(Z=projectNormal(a,M,V,W,segmentEndNormal2DScratch),X.x=0,X.y=CesiumMath.sign(P.longitude-Math.abs(M.longitude)),X.z=0):(X=projectNormal(a,P,Q,q,segmentStartNormal2DScratch),Z.x=0,Z.y=CesiumMath.sign(P.longitude-M.longitude),Z.z=0)}var tt=Cartesian3.distance(K,b),at=EncodedCartesian3.fromCartesian(J,encodeScratch),et=Cartesian3.subtract(H,J,offsetScratch),rt=Cartesian3.normalize(et,rightScratch),nt=Cartesian3.subtract(K,J,startUpScratch);nt=Cartesian3.normalize(nt,nt);var it=Cartesian3.cross(rt,nt,rightScratch);it=Cartesian3.normalize(it,it);var ot=Cartesian3.cross(nt,Q,startPlaneNormalScratch);ot=Cartesian3.normalize(ot,ot);var ct=Cartesian3.subtract(b,H,endUpScratch);ct=Cartesian3.normalize(ct,ct);var st=Cartesian3.cross(V,ct,endPlaneNormalScratch);st=Cartesian3.normalize(st,st);var ht,lt,pt,mt=tt/D,Ct=z/D,ut=0,dt=0,gt=0;if(o){ut=Cartesian3.distance(q,W),ht=EncodedCartesian3.fromCartesian(q,encodeScratch2D),lt=Cartesian3.subtract(W,q,forwardOffset2DScratch);var St=(pt=Cartesian3.normalize(lt,right2DScratch)).x;pt.x=pt.y,pt.y=-St,dt=ut/A,gt=F/A}for(O=0;O<8;O++){var Et=x+4*O,ft=R+2*O,yt=Et+3,Nt=O<4?1:-1,wt=2===O||3===O||6===O||7===O?1:-1;Cartesian3.pack(at.high,y,Et),y[yt]=et.x,Cartesian3.pack(at.low,N,Et),N[yt]=et.y,Cartesian3.pack(ot,w,Et),w[yt]=et.z,Cartesian3.pack(st,T,Et),T[yt]=mt*Nt,Cartesian3.pack(it,v,Et);var Tt=Ct*wt;0===Tt&&wt<0&&(Tt=9),v[yt]=Tt,o&&(h[Et]=ht.high.x,h[Et+1]=ht.high.y,h[Et+2]=ht.low.x,h[Et+3]=ht.low.y,p[Et]=-X.y,p[Et+1]=X.x,p[Et+2]=Z.y,p[Et+3]=-Z.x,l[Et]=lt.x,l[Et+1]=lt.y,l[Et+2]=pt.x,l[Et+3]=pt.y,m[ft]=dt*Nt,0==(Tt=gt*wt)&&wt<0&&(Tt=9),m[ft+1]=Tt)}var vt=adjustHeightStartBottomScratch,It=adjustHeightEndBottomScratch,At=adjustHeightStartTopScratch,Pt=adjustHeightEndTopScratch,Mt=Rectangle.fromCartographicArray(getHeightCartographics,getHeightRectangleScratch),_t=ApproximateTerrainHeights.getMinimumMaximumHeights(Mt,C),Lt=_t.minimumTerrainHeight,jt=_t.maximumTerrainHeight;U+=Lt,U+=jt,adjustHeights(J,K,Lt,jt,vt,At),adjustHeights(H,b,Lt,jt,It,Pt);var Ot=Cartesian3.multiplyByScalar(it,CesiumMath.EPSILON5,normalNudgeScratch);Cartesian3.add(vt,Ot,vt),Cartesian3.add(It,Ot,It),Cartesian3.add(At,Ot,At),Cartesian3.add(Pt,Ot,Pt),nudgeXZ(vt,It),nudgeXZ(At,Pt),Cartesian3.pack(vt,f,k),Cartesian3.pack(It,f,k+3),Cartesian3.pack(Pt,f,k+6),Cartesian3.pack(At,f,k+9),Ot=Cartesian3.multiplyByScalar(it,-2*CesiumMath.EPSILON5,normalNudgeScratch),Cartesian3.add(vt,Ot,vt),Cartesian3.add(It,Ot,It),Cartesian3.add(At,Ot,At),Cartesian3.add(Pt,Ot,Pt),nudgeXZ(vt,It),nudgeXZ(At,Pt),Cartesian3.pack(vt,f,k+12),Cartesian3.pack(It,f,k+15),Cartesian3.pack(Pt,f,k+18),Cartesian3.pack(At,f,k+21),G+=2,s+=3,R+=16,k+=24,x+=32,z+=tt,F+=ut}s=0;var Dt=0;for(c=0;c<u;c++){for(O=0;O<REFERENCE_INDICES_LENGTH;O++)E[s+O]=REFERENCE_INDICES[O]+Dt;Dt+=8,s+=REFERENCE_INDICES_LENGTH}var Gt=scratchBoundingSpheres;BoundingSphere.fromVertices(e,Cartesian3.ZERO,3,Gt[0]),BoundingSphere.fromVertices(r,Cartesian3.ZERO,3,Gt[1]);var Rt=BoundingSphere.fromBoundingSpheres(Gt);Rt.radius+=U/(2*u);var kt={position:new GeometryAttribute({componentDatatype:ComponentDatatype.DOUBLE,componentsPerAttribute:3,normalize:!1,values:f}),startHiAndForwardOffsetX:getVec4GeometryAttribute(y),startLoAndForwardOffsetY:getVec4GeometryAttribute(N),startNormalAndForwardOffsetZ:getVec4GeometryAttribute(w),endNormalAndTextureCoordinateNormalizationX:getVec4GeometryAttribute(T),rightNormalAndTextureCoordinateNormalizationY:getVec4GeometryAttribute(v)};return o&&(kt.startHiLo2D=getVec4GeometryAttribute(h),kt.offsetAndRight2D=getVec4GeometryAttribute(l),kt.startEndNormals2D=getVec4GeometryAttribute(p),kt.texcoordNormalization2D=new GeometryAttribute({componentDatatype:ComponentDatatype.FLOAT,componentsPerAttribute:2,normalize:!1,values:m})),new Geometry({attributes:kt,indices:E,boundingSphere:Rt})}function getVec4GeometryAttribute(t){return new GeometryAttribute({componentDatatype:ComponentDatatype.FLOAT,componentsPerAttribute:4,normalize:!1,values:t})}GroundPolylineGeometry._projectNormal=projectNormal;export default GroundPolylineGeometry;