import Cartesian3 from"./Cartesian3.js";import Check from"./Check.js";import defaultValue from"./defaultValue.js";import defined from"./defined.js";import DeveloperError from"./DeveloperError.js";import CesiumMath from"./Math.js";function Matrix3(e,t,r,a,n,i,c,o,u){this[0]=defaultValue(e,0),this[1]=defaultValue(a,0),this[2]=defaultValue(c,0),this[3]=defaultValue(t,0),this[4]=defaultValue(n,0),this[5]=defaultValue(o,0),this[6]=defaultValue(r,0),this[7]=defaultValue(i,0),this[8]=defaultValue(u,0)}Matrix3.packedLength=9,Matrix3.pack=function(e,t,r){return Check.typeOf.object("value",e),Check.defined("array",t),r=defaultValue(r,0),t[r++]=e[0],t[r++]=e[1],t[r++]=e[2],t[r++]=e[3],t[r++]=e[4],t[r++]=e[5],t[r++]=e[6],t[r++]=e[7],t[r++]=e[8],t},Matrix3.unpack=function(e,t,r){return Check.defined("array",e),t=defaultValue(t,0),defined(r)||(r=new Matrix3),r[0]=e[t++],r[1]=e[t++],r[2]=e[t++],r[3]=e[t++],r[4]=e[t++],r[5]=e[t++],r[6]=e[t++],r[7]=e[t++],r[8]=e[t++],r},Matrix3.clone=function(e,t){if(defined(e))return defined(t)?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t):new Matrix3(e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8])},Matrix3.fromArray=function(e,t,r){return Check.defined("array",e),t=defaultValue(t,0),defined(r)||(r=new Matrix3),r[0]=e[t],r[1]=e[t+1],r[2]=e[t+2],r[3]=e[t+3],r[4]=e[t+4],r[5]=e[t+5],r[6]=e[t+6],r[7]=e[t+7],r[8]=e[t+8],r},Matrix3.fromColumnMajorArray=function(e,t){return Check.defined("values",e),Matrix3.clone(e,t)},Matrix3.fromRowMajorArray=function(e,t){return Check.defined("values",e),defined(t)?(t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],t):new Matrix3(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])},Matrix3.fromQuaternion=function(e,t){Check.typeOf.object("quaternion",e);var r=e.x*e.x,a=e.x*e.y,n=e.x*e.z,i=e.x*e.w,c=e.y*e.y,o=e.y*e.z,u=e.y*e.w,s=e.z*e.z,f=e.z*e.w,l=e.w*e.w,x=r-c-s+l,h=2*(a-f),M=2*(n+u),p=2*(a+f),m=-r+c-s+l,y=2*(o-i),C=2*(n-u),d=2*(o+i),O=-r-c+s+l;return defined(t)?(t[0]=x,t[1]=p,t[2]=C,t[3]=h,t[4]=m,t[5]=d,t[6]=M,t[7]=y,t[8]=O,t):new Matrix3(x,h,M,p,m,y,C,d,O)},Matrix3.fromHeadingPitchRoll=function(e,t){Check.typeOf.object("headingPitchRoll",e);var r=Math.cos(-e.pitch),a=Math.cos(-e.heading),n=Math.cos(e.roll),i=Math.sin(-e.pitch),c=Math.sin(-e.heading),o=Math.sin(e.roll),u=r*a,s=-n*c+o*i*a,f=o*c+n*i*a,l=r*c,x=n*a+o*i*c,h=-o*a+n*i*c,M=-i,p=o*r,m=n*r;return defined(t)?(t[0]=u,t[1]=l,t[2]=M,t[3]=s,t[4]=x,t[5]=p,t[6]=f,t[7]=h,t[8]=m,t):new Matrix3(u,s,f,l,x,h,M,p,m)},Matrix3.fromScale=function(e,t){return Check.typeOf.object("scale",e),defined(t)?(t[0]=e.x,t[1]=0,t[2]=0,t[3]=0,t[4]=e.y,t[5]=0,t[6]=0,t[7]=0,t[8]=e.z,t):new Matrix3(e.x,0,0,0,e.y,0,0,0,e.z)},Matrix3.fromUniformScale=function(e,t){return Check.typeOf.number("scale",e),defined(t)?(t[0]=e,t[1]=0,t[2]=0,t[3]=0,t[4]=e,t[5]=0,t[6]=0,t[7]=0,t[8]=e,t):new Matrix3(e,0,0,0,e,0,0,0,e)},Matrix3.fromCrossProduct=function(e,t){return Check.typeOf.object("vector",e),defined(t)?(t[0]=0,t[1]=e.z,t[2]=-e.y,t[3]=-e.z,t[4]=0,t[5]=e.x,t[6]=e.y,t[7]=-e.x,t[8]=0,t):new Matrix3(0,-e.z,e.y,e.z,0,-e.x,-e.y,e.x,0)},Matrix3.fromRotationX=function(e,t){Check.typeOf.number("angle",e);var r=Math.cos(e),a=Math.sin(e);return defined(t)?(t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=r,t[5]=a,t[6]=0,t[7]=-a,t[8]=r,t):new Matrix3(1,0,0,0,r,-a,0,a,r)},Matrix3.fromRotationY=function(e,t){Check.typeOf.number("angle",e);var r=Math.cos(e),a=Math.sin(e);return defined(t)?(t[0]=r,t[1]=0,t[2]=-a,t[3]=0,t[4]=1,t[5]=0,t[6]=a,t[7]=0,t[8]=r,t):new Matrix3(r,0,a,0,1,0,-a,0,r)},Matrix3.fromRotationZ=function(e,t){Check.typeOf.number("angle",e);var r=Math.cos(e),a=Math.sin(e);return defined(t)?(t[0]=r,t[1]=a,t[2]=0,t[3]=-a,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t):new Matrix3(r,-a,0,a,r,0,0,0,1)},Matrix3.toArray=function(e,t){return Check.typeOf.object("matrix",e),defined(t)?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t):[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]},Matrix3.getElementIndex=function(e,t){return Check.typeOf.number.greaterThanOrEquals("row",t,0),Check.typeOf.number.lessThanOrEquals("row",t,2),Check.typeOf.number.greaterThanOrEquals("column",e,0),Check.typeOf.number.lessThanOrEquals("column",e,2),3*e+t},Matrix3.getColumn=function(e,t,r){Check.typeOf.object("matrix",e),Check.typeOf.number.greaterThanOrEquals("index",t,0),Check.typeOf.number.lessThanOrEquals("index",t,2),Check.typeOf.object("result",r);var a=3*t,n=e[a],i=e[a+1],c=e[a+2];return r.x=n,r.y=i,r.z=c,r},Matrix3.setColumn=function(e,t,r,a){Check.typeOf.object("matrix",e),Check.typeOf.number.greaterThanOrEquals("index",t,0),Check.typeOf.number.lessThanOrEquals("index",t,2),Check.typeOf.object("cartesian",r),Check.typeOf.object("result",a);var n=3*t;return(a=Matrix3.clone(e,a))[n]=r.x,a[n+1]=r.y,a[n+2]=r.z,a},Matrix3.getRow=function(e,t,r){Check.typeOf.object("matrix",e),Check.typeOf.number.greaterThanOrEquals("index",t,0),Check.typeOf.number.lessThanOrEquals("index",t,2),Check.typeOf.object("result",r);var a=e[t],n=e[t+3],i=e[t+6];return r.x=a,r.y=n,r.z=i,r},Matrix3.setRow=function(e,t,r,a){return Check.typeOf.object("matrix",e),Check.typeOf.number.greaterThanOrEquals("index",t,0),Check.typeOf.number.lessThanOrEquals("index",t,2),Check.typeOf.object("cartesian",r),Check.typeOf.object("result",a),(a=Matrix3.clone(e,a))[t]=r.x,a[t+3]=r.y,a[t+6]=r.z,a};var scratchColumn=new Cartesian3;Matrix3.getScale=function(e,t){return Check.typeOf.object("matrix",e),Check.typeOf.object("result",t),t.x=Cartesian3.magnitude(Cartesian3.fromElements(e[0],e[1],e[2],scratchColumn)),t.y=Cartesian3.magnitude(Cartesian3.fromElements(e[3],e[4],e[5],scratchColumn)),t.z=Cartesian3.magnitude(Cartesian3.fromElements(e[6],e[7],e[8],scratchColumn)),t};var scratchScale=new Cartesian3;Matrix3.getMaximumScale=function(e){return Matrix3.getScale(e,scratchScale),Cartesian3.maximumComponent(scratchScale)},Matrix3.multiply=function(e,t,r){Check.typeOf.object("left",e),Check.typeOf.object("right",t),Check.typeOf.object("result",r);var a=e[0]*t[0]+e[3]*t[1]+e[6]*t[2],n=e[1]*t[0]+e[4]*t[1]+e[7]*t[2],i=e[2]*t[0]+e[5]*t[1]+e[8]*t[2],c=e[0]*t[3]+e[3]*t[4]+e[6]*t[5],o=e[1]*t[3]+e[4]*t[4]+e[7]*t[5],u=e[2]*t[3]+e[5]*t[4]+e[8]*t[5],s=e[0]*t[6]+e[3]*t[7]+e[6]*t[8],f=e[1]*t[6]+e[4]*t[7]+e[7]*t[8],l=e[2]*t[6]+e[5]*t[7]+e[8]*t[8];return r[0]=a,r[1]=n,r[2]=i,r[3]=c,r[4]=o,r[5]=u,r[6]=s,r[7]=f,r[8]=l,r},Matrix3.add=function(e,t,r){return Check.typeOf.object("left",e),Check.typeOf.object("right",t),Check.typeOf.object("result",r),r[0]=e[0]+t[0],r[1]=e[1]+t[1],r[2]=e[2]+t[2],r[3]=e[3]+t[3],r[4]=e[4]+t[4],r[5]=e[5]+t[5],r[6]=e[6]+t[6],r[7]=e[7]+t[7],r[8]=e[8]+t[8],r},Matrix3.subtract=function(e,t,r){return Check.typeOf.object("left",e),Check.typeOf.object("right",t),Check.typeOf.object("result",r),r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],r[3]=e[3]-t[3],r[4]=e[4]-t[4],r[5]=e[5]-t[5],r[6]=e[6]-t[6],r[7]=e[7]-t[7],r[8]=e[8]-t[8],r},Matrix3.multiplyByVector=function(e,t,r){Check.typeOf.object("matrix",e),Check.typeOf.object("cartesian",t),Check.typeOf.object("result",r);var a=t.x,n=t.y,i=t.z,c=e[0]*a+e[3]*n+e[6]*i,o=e[1]*a+e[4]*n+e[7]*i,u=e[2]*a+e[5]*n+e[8]*i;return r.x=c,r.y=o,r.z=u,r},Matrix3.multiplyByScalar=function(e,t,r){return Check.typeOf.object("matrix",e),Check.typeOf.number("scalar",t),Check.typeOf.object("result",r),r[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t,r[3]=e[3]*t,r[4]=e[4]*t,r[5]=e[5]*t,r[6]=e[6]*t,r[7]=e[7]*t,r[8]=e[8]*t,r},Matrix3.multiplyByScale=function(e,t,r){return Check.typeOf.object("matrix",e),Check.typeOf.object("scale",t),Check.typeOf.object("result",r),r[0]=e[0]*t.x,r[1]=e[1]*t.x,r[2]=e[2]*t.x,r[3]=e[3]*t.y,r[4]=e[4]*t.y,r[5]=e[5]*t.y,r[6]=e[6]*t.z,r[7]=e[7]*t.z,r[8]=e[8]*t.z,r},Matrix3.negate=function(e,t){return Check.typeOf.object("matrix",e),Check.typeOf.object("result",t),t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=-e[7],t[8]=-e[8],t},Matrix3.transpose=function(e,t){Check.typeOf.object("matrix",e),Check.typeOf.object("result",t);var r=e[0],a=e[3],n=e[6],i=e[1],c=e[4],o=e[7],u=e[2],s=e[5],f=e[8];return t[0]=r,t[1]=a,t[2]=n,t[3]=i,t[4]=c,t[5]=o,t[6]=u,t[7]=s,t[8]=f,t};var UNIT=new Cartesian3(1,1,1);function computeFrobeniusNorm(e){for(var t=0,r=0;r<9;++r){var a=e[r];t+=a*a}return Math.sqrt(t)}Matrix3.getRotation=function(e,t){Check.typeOf.object("matrix",e),Check.typeOf.object("result",t);var r=Cartesian3.divideComponents(UNIT,Matrix3.getScale(e,scratchScale),scratchScale);return Matrix3.multiplyByScale(e,r,t)};var rowVal=[1,0,0],colVal=[2,2,1];function offDiagonalFrobeniusNorm(e){for(var t=0,r=0;r<3;++r){var a=e[Matrix3.getElementIndex(colVal[r],rowVal[r])];t+=2*a*a}return Math.sqrt(t)}function shurDecomposition(e,t){for(var r=CesiumMath.EPSILON15,a=0,n=1,i=0;i<3;++i){var c=Math.abs(e[Matrix3.getElementIndex(colVal[i],rowVal[i])]);c>a&&(n=i,a=c)}var o=1,u=0,s=rowVal[n],f=colVal[n];if(Math.abs(e[Matrix3.getElementIndex(f,s)])>r){var l,x=(e[Matrix3.getElementIndex(f,f)]-e[Matrix3.getElementIndex(s,s)])/2/e[Matrix3.getElementIndex(f,s)];u=(l=x<0?-1/(-x+Math.sqrt(1+x*x)):1/(x+Math.sqrt(1+x*x)))*(o=1/Math.sqrt(1+l*l))}return(t=Matrix3.clone(Matrix3.IDENTITY,t))[Matrix3.getElementIndex(s,s)]=t[Matrix3.getElementIndex(f,f)]=o,t[Matrix3.getElementIndex(f,s)]=u,t[Matrix3.getElementIndex(s,f)]=-u,t}var jMatrix=new Matrix3,jMatrixTranspose=new Matrix3;Matrix3.computeEigenDecomposition=function(e,t){Check.typeOf.object("matrix",e);var r=CesiumMath.EPSILON20,a=0,n=0;defined(t)||(t={});for(var i=t.unitary=Matrix3.clone(Matrix3.IDENTITY,t.unitary),c=t.diagonal=Matrix3.clone(e,t.diagonal),o=r*computeFrobeniusNorm(c);n<10&&offDiagonalFrobeniusNorm(c)>o;)shurDecomposition(c,jMatrix),Matrix3.transpose(jMatrix,jMatrixTranspose),Matrix3.multiply(c,jMatrix,c),Matrix3.multiply(jMatrixTranspose,c,c),Matrix3.multiply(i,jMatrix,i),++a>2&&(++n,a=0);return t},Matrix3.abs=function(e,t){return Check.typeOf.object("matrix",e),Check.typeOf.object("result",t),t[0]=Math.abs(e[0]),t[1]=Math.abs(e[1]),t[2]=Math.abs(e[2]),t[3]=Math.abs(e[3]),t[4]=Math.abs(e[4]),t[5]=Math.abs(e[5]),t[6]=Math.abs(e[6]),t[7]=Math.abs(e[7]),t[8]=Math.abs(e[8]),t},Matrix3.determinant=function(e){Check.typeOf.object("matrix",e);var t=e[0],r=e[3],a=e[6],n=e[1],i=e[4],c=e[7],o=e[2],u=e[5],s=e[8];return t*(i*s-u*c)+n*(u*a-r*s)+o*(r*c-i*a)},Matrix3.inverse=function(e,t){Check.typeOf.object("matrix",e),Check.typeOf.object("result",t);var r=e[0],a=e[1],n=e[2],i=e[3],c=e[4],o=e[5],u=e[6],s=e[7],f=e[8],l=Matrix3.determinant(e);if(Math.abs(l)<=CesiumMath.EPSILON15)throw new DeveloperError("matrix is not invertible");t[0]=c*f-s*o,t[1]=s*n-a*f,t[2]=a*o-c*n,t[3]=u*o-i*f,t[4]=r*f-u*n,t[5]=i*n-r*o,t[6]=i*s-u*c,t[7]=u*a-r*s,t[8]=r*c-i*a;var x=1/l;return Matrix3.multiplyByScalar(t,x,t)};var scratchTransposeMatrix=new Matrix3;Matrix3.inverseTranspose=function(e,t){return Check.typeOf.object("matrix",e),Check.typeOf.object("result",t),Matrix3.inverse(Matrix3.transpose(e,scratchTransposeMatrix),t)},Matrix3.equals=function(e,t){return e===t||defined(e)&&defined(t)&&e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]},Matrix3.equalsEpsilon=function(e,t,r){return r=defaultValue(r,0),e===t||defined(e)&&defined(t)&&Math.abs(e[0]-t[0])<=r&&Math.abs(e[1]-t[1])<=r&&Math.abs(e[2]-t[2])<=r&&Math.abs(e[3]-t[3])<=r&&Math.abs(e[4]-t[4])<=r&&Math.abs(e[5]-t[5])<=r&&Math.abs(e[6]-t[6])<=r&&Math.abs(e[7]-t[7])<=r&&Math.abs(e[8]-t[8])<=r},Matrix3.IDENTITY=Object.freeze(new Matrix3(1,0,0,0,1,0,0,0,1)),Matrix3.ZERO=Object.freeze(new Matrix3(0,0,0,0,0,0,0,0,0)),Matrix3.COLUMN0ROW0=0,Matrix3.COLUMN0ROW1=1,Matrix3.COLUMN0ROW2=2,Matrix3.COLUMN1ROW0=3,Matrix3.COLUMN1ROW1=4,Matrix3.COLUMN1ROW2=5,Matrix3.COLUMN2ROW0=6,Matrix3.COLUMN2ROW1=7,Matrix3.COLUMN2ROW2=8,Object.defineProperties(Matrix3.prototype,{length:{get:function(){return Matrix3.packedLength}}}),Matrix3.prototype.clone=function(e){return Matrix3.clone(this,e)},Matrix3.prototype.equals=function(e){return Matrix3.equals(this,e)},Matrix3.equalsArray=function(e,t,r){return e[0]===t[r]&&e[1]===t[r+1]&&e[2]===t[r+2]&&e[3]===t[r+3]&&e[4]===t[r+4]&&e[5]===t[r+5]&&e[6]===t[r+6]&&e[7]===t[r+7]&&e[8]===t[r+8]},Matrix3.prototype.equalsEpsilon=function(e,t){return Matrix3.equalsEpsilon(this,e,t)},Matrix3.prototype.toString=function(){return"("+this[0]+", "+this[3]+", "+this[6]+")\n("+this[1]+", "+this[4]+", "+this[7]+")\n("+this[2]+", "+this[5]+", "+this[8]+")"};export default Matrix3;