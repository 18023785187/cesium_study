import ClockRange from"./ClockRange.js";import ClockStep from"./ClockStep.js";import defaultValue from"./defaultValue.js";import defined from"./defined.js";import DeveloperError from"./DeveloperError.js";import Event from"./Event.js";import getTimestamp from"./getTimestamp.js";import JulianDate from"./JulianDate.js";function Clock(e){var t=(e=defaultValue(e,defaultValue.EMPTY_OBJECT)).currentTime,i=e.startTime,a=e.stopTime;if(t=defined(t)?JulianDate.clone(t):defined(i)?JulianDate.clone(i):defined(a)?JulianDate.addDays(a,-1,new JulianDate):JulianDate.now(),i=defined(i)?JulianDate.clone(i):JulianDate.clone(t),a=defined(a)?JulianDate.clone(a):JulianDate.addDays(i,1,new JulianDate),JulianDate.greaterThan(i,a))throw new DeveloperError("startTime must come before stopTime.");this.startTime=i,this.stopTime=a,this.clockRange=defaultValue(e.clockRange,ClockRange.UNBOUNDED),this.canAnimate=defaultValue(e.canAnimate,!0),this.onTick=new Event,this.onStop=new Event,this._currentTime=void 0,this._multiplier=void 0,this._clockStep=void 0,this._shouldAnimate=void 0,this._lastSystemTime=getTimestamp(),this.currentTime=t,this.multiplier=defaultValue(e.multiplier,1),this.shouldAnimate=defaultValue(e.shouldAnimate,!1),this.clockStep=defaultValue(e.clockStep,ClockStep.SYSTEM_CLOCK_MULTIPLIER)}Object.defineProperties(Clock.prototype,{currentTime:{get:function(){return this._currentTime},set:function(e){JulianDate.equals(this._currentTime,e)||(this._clockStep===ClockStep.SYSTEM_CLOCK&&(this._clockStep=ClockStep.SYSTEM_CLOCK_MULTIPLIER),this._currentTime=e)}},multiplier:{get:function(){return this._multiplier},set:function(e){this._multiplier!==e&&(this._clockStep===ClockStep.SYSTEM_CLOCK&&(this._clockStep=ClockStep.SYSTEM_CLOCK_MULTIPLIER),this._multiplier=e)}},clockStep:{get:function(){return this._clockStep},set:function(e){e===ClockStep.SYSTEM_CLOCK&&(this._multiplier=1,this._shouldAnimate=!0,this._currentTime=JulianDate.now()),this._clockStep=e}},shouldAnimate:{get:function(){return this._shouldAnimate},set:function(e){this._shouldAnimate!==e&&(this._clockStep===ClockStep.SYSTEM_CLOCK&&(this._clockStep=ClockStep.SYSTEM_CLOCK_MULTIPLIER),this._shouldAnimate=e)}}}),Clock.prototype.tick=function(){var e=getTimestamp(),t=JulianDate.clone(this._currentTime);if(this.canAnimate&&this._shouldAnimate){var i=this._clockStep;if(i===ClockStep.SYSTEM_CLOCK)t=JulianDate.now(t);else{var a=this._multiplier;if(i===ClockStep.TICK_DEPENDENT)t=JulianDate.addSeconds(t,a,t);else{var n=e-this._lastSystemTime;t=JulianDate.addSeconds(t,a*(n/1e3),t)}var l=this.clockRange,o=this.startTime,s=this.stopTime;if(l===ClockRange.CLAMPED)JulianDate.lessThan(t,o)?t=JulianDate.clone(o,t):JulianDate.greaterThan(t,s)&&(t=JulianDate.clone(s,t),this.onStop.raiseEvent(this));else if(l===ClockRange.LOOP_STOP)for(JulianDate.lessThan(t,o)&&(t=JulianDate.clone(o,t));JulianDate.greaterThan(t,s);)t=JulianDate.addSeconds(o,JulianDate.secondsDifference(t,s),t),this.onStop.raiseEvent(this)}}return this._currentTime=t,this._lastSystemTime=e,this.onTick.raiseEvent(this),t};export default Clock;