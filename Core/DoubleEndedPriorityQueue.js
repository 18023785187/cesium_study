import CesiumMath from"./Math.js";import Check from"./Check.js";import defined from"./defined.js";function DoubleEndedPriorityQueue(r){Check.typeOf.object("options",r),Check.defined("options.comparator",r.comparator),defined(r.maximumLength)&&Check.typeOf.number.greaterThanOrEquals("options.maximumLength",r.maximumLength,0),this._comparator=r.comparator,this._maximumLength=r.maximumLength,this._array=defined(r.maximumLength)?new Array(r.maximumLength):[],this._length=0}function swap(r,t,e){var i=r._array,a=i[t];i[t]=i[e],i[e]=a}function lessThan(r,t,e){return r._comparator(r._array[t],r._array[e])<0}function greaterThan(r,t,e){return r._comparator(r._array[t],r._array[e])>0}function pushUp(r,t){if(0!==t){var e=Math.floor(CesiumMath.log2(t+1))%2==0,i=Math.floor((t-1)/2),a=lessThan(r,t,i);for(a!==e&&(swap(r,t,i),t=i);t>=3;){var n=Math.floor((t-3)/4);if(lessThan(r,t,n)!==a)break;swap(r,t,n),t=n}}}function pushDown(r,t){for(var e,i=r._length,a=Math.floor(CesiumMath.log2(t+1))%2==0;(e=2*t+1)<i;){var n=e,o=e+1;if(o<i){lessThan(r,o,n)===a&&(n=o);for(var h=2*e+1,u=Math.max(Math.min(i-h,4),0),s=0;s<u;s++){var m=h+s;lessThan(r,m,n)===a&&(n=m)}}if(lessThan(r,n,t)===a&&(swap(r,n,t),n!==e&&n!==o)){var f=Math.floor((n-1)/2);greaterThan(r,n,f)===a&&swap(r,n,f)}t=n}}Object.defineProperties(DoubleEndedPriorityQueue.prototype,{length:{get:function(){return this._length}},maximumLength:{get:function(){return this._maximumLength},set:function(r){if(defined(r)){for(Check.typeOf.number.greaterThanOrEquals("maximumLength",r,0);this._length>r;)this.removeMinimum();this._array.length=r}this._maximumLength=r}},internalArray:{get:function(){return this._array}},comparator:{get:function(){return this._comparator}}}),DoubleEndedPriorityQueue.prototype.clone=function(){var r=this._maximumLength,t=this._comparator,e=this._array,i=this._length,a=new DoubleEndedPriorityQueue({comparator:t,maximumLength:r});a._length=i;for(var n=0;n<i;n++)a._array[n]=e[n];return a},DoubleEndedPriorityQueue.prototype.reset=function(){this._length=0;var r=this._maximumLength;if(defined(r))for(var t=0;t<r;t++)this._array[t]=void 0;else this._array.length=0},DoubleEndedPriorityQueue.prototype.resort=function(){for(var r=this._length,t=0;t<r;t++)pushUp(this,t)},DoubleEndedPriorityQueue.prototype.insert=function(r){var t,e=this._maximumLength;if(defined(e)){if(0===e)return;if(this._length===e){var i=this._array[0];if(this._comparator(r,i)<=0)return r;t=this.removeMinimum()}}var a=this._length;return this._array[a]=r,this._length++,pushUp(this,a),t},DoubleEndedPriorityQueue.prototype.removeMinimum=function(){var r=this._length;if(0!==r){this._length--;var t=this._array[0];return r>=2&&(this._array[0]=this._array[r-1],pushDown(this,0)),this._array[r-1]=void 0,t}},DoubleEndedPriorityQueue.prototype.removeMaximum=function(){var r=this._length;if(0!==r){var t;if(this._length--,r<=2)t=this._array[r-1];else{var e=greaterThan(this,1,2)?1:2;t=this._array[e],this._array[e]=this._array[r-1],r>=4&&pushDown(this,e)}return this._array[r-1]=void 0,t}},DoubleEndedPriorityQueue.prototype.getMinimum=function(){if(0!==this._length)return this._array[0]},DoubleEndedPriorityQueue.prototype.getMaximum=function(){var r=this._length;if(0!==r)return r<=2?this._array[r-1]:this._array[greaterThan(this,1,2)?1:2]};export default DoubleEndedPriorityQueue;