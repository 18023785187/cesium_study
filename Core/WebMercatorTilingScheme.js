import Cartesian2 from"./Cartesian2.js";import defaultValue from"./defaultValue.js";import defined from"./defined.js";import Ellipsoid from"./Ellipsoid.js";import Rectangle from"./Rectangle.js";import WebMercatorProjection from"./WebMercatorProjection.js";function WebMercatorTilingScheme(e){if(e=defaultValue(e,defaultValue.EMPTY_OBJECT),this._ellipsoid=defaultValue(e.ellipsoid,Ellipsoid.WGS84),this._numberOfLevelZeroTilesX=defaultValue(e.numberOfLevelZeroTilesX,1),this._numberOfLevelZeroTilesY=defaultValue(e.numberOfLevelZeroTilesY,1),this._projection=new WebMercatorProjection(this._ellipsoid),defined(e.rectangleSouthwestInMeters)&&defined(e.rectangleNortheastInMeters))this._rectangleSouthwestInMeters=e.rectangleSouthwestInMeters,this._rectangleNortheastInMeters=e.rectangleNortheastInMeters;else{var t=this._ellipsoid.maximumRadius*Math.PI;this._rectangleSouthwestInMeters=new Cartesian2(-t,-t),this._rectangleNortheastInMeters=new Cartesian2(t,t)}var r=this._projection.unproject(this._rectangleSouthwestInMeters),n=this._projection.unproject(this._rectangleNortheastInMeters);this._rectangle=new Rectangle(r.longitude,r.latitude,n.longitude,n.latitude)}Object.defineProperties(WebMercatorTilingScheme.prototype,{ellipsoid:{get:function(){return this._ellipsoid}},rectangle:{get:function(){return this._rectangle}},projection:{get:function(){return this._projection}}}),WebMercatorTilingScheme.prototype.getNumberOfXTilesAtLevel=function(e){return this._numberOfLevelZeroTilesX<<e},WebMercatorTilingScheme.prototype.getNumberOfYTilesAtLevel=function(e){return this._numberOfLevelZeroTilesY<<e},WebMercatorTilingScheme.prototype.rectangleToNativeRectangle=function(e,t){var r=this._projection,n=r.project(Rectangle.southwest(e)),i=r.project(Rectangle.northeast(e));return defined(t)?(t.west=n.x,t.south=n.y,t.east=i.x,t.north=i.y,t):new Rectangle(n.x,n.y,i.x,i.y)},WebMercatorTilingScheme.prototype.tileXYToNativeRectangle=function(e,t,r,n){var i=this.getNumberOfXTilesAtLevel(r),s=this.getNumberOfYTilesAtLevel(r),o=(this._rectangleNortheastInMeters.x-this._rectangleSouthwestInMeters.x)/i,l=this._rectangleSouthwestInMeters.x+e*o,a=this._rectangleSouthwestInMeters.x+(e+1)*o,c=(this._rectangleNortheastInMeters.y-this._rectangleSouthwestInMeters.y)/s,h=this._rectangleNortheastInMeters.y-t*c,u=this._rectangleNortheastInMeters.y-(t+1)*c;return defined(n)?(n.west=l,n.south=u,n.east=a,n.north=h,n):new Rectangle(l,u,a,h)},WebMercatorTilingScheme.prototype.tileXYToRectangle=function(e,t,r,n){var i=this.tileXYToNativeRectangle(e,t,r,n),s=this._projection,o=s.unproject(new Cartesian2(i.west,i.south)),l=s.unproject(new Cartesian2(i.east,i.north));return i.west=o.longitude,i.south=o.latitude,i.east=l.longitude,i.north=l.latitude,i},WebMercatorTilingScheme.prototype.positionToTileXY=function(e,t,r){var n=this._rectangle;if(Rectangle.contains(n,e)){var i=this.getNumberOfXTilesAtLevel(t),s=this.getNumberOfYTilesAtLevel(t),o=(this._rectangleNortheastInMeters.x-this._rectangleSouthwestInMeters.x)/i,l=(this._rectangleNortheastInMeters.y-this._rectangleSouthwestInMeters.y)/s,a=this._projection.project(e),c=(a.x-this._rectangleSouthwestInMeters.x)/o|0;c>=i&&(c=i-1);var h=(this._rectangleNortheastInMeters.y-a.y)/l|0;return h>=s&&(h=s-1),defined(r)?(r.x=c,r.y=h,r):new Cartesian2(c,h)}};export default WebMercatorTilingScheme;