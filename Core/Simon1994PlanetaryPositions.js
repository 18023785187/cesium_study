import Cartesian3 from"./Cartesian3.js";import defined from"./defined.js";import DeveloperError from"./DeveloperError.js";import JulianDate from"./JulianDate.js";import CesiumMath from"./Math.js";import Matrix3 from"./Matrix3.js";import TimeConstants from"./TimeConstants.js";import TimeStandard from"./TimeStandard.js";var Simon1994PlanetaryPositions={};function computeTdbMinusTtSpice(a){var e=6.239996+.0172019696544*a;return.001657*Math.sin(e+.01671*Math.sin(e))}var TdtMinusTai=32.184,J2000d=2451545;function taiToTdb(a,e){e=JulianDate.addSeconds(a,TdtMinusTai,e);var t=JulianDate.totalDays(e)-J2000d;return JulianDate.addSeconds(e,computeTdbMinusTtSpice(t),e)}var epoch=new JulianDate(2451545,0,TimeStandard.TAI),MetersPerKilometer=1e3,RadiansPerDegree=CesiumMath.RADIANS_PER_DEGREE,RadiansPerArcSecond=CesiumMath.RADIANS_PER_ARCSECOND,MetersPerAstronomicalUnit=14959787e4,perifocalToEquatorial=new Matrix3;function elementsToCartesian(a,e,t,n,r,o,i){if(t<0&&(t=-t,r+=CesiumMath.PI),t<0||t>CesiumMath.PI)throw new DeveloperError("The inclination is out of range. Inclination must be greater than or equal to zero and less than or equal to Pi radians.");var s=a*(1-e),c=n-r,M=r,h=meanAnomalyToTrueAnomaly(o-n,e);if("Hyperbolic"===chooseOrbit(e,0)&&Math.abs(CesiumMath.negativePiToPi(h))>=Math.acos(-1/e))throw new DeveloperError("The true anomaly of the hyperbolic orbit lies outside of the bounds of the hyperbola.");perifocalToCartesianMatrix(c,t,M,perifocalToEquatorial);var u=s*(1+e),l=Math.cos(h),m=Math.sin(h),d=1+e*l;if(d<=CesiumMath.Epsilon10)throw new DeveloperError("elements cannot be converted to cartesian");var p=u/d;return defined(i)?(i.x=p*l,i.y=p*m,i.z=0):i=new Cartesian3(p*l,p*m,0),Matrix3.multiplyByVector(perifocalToEquatorial,i,i)}function chooseOrbit(a,e){if(a<0)throw new DeveloperError("eccentricity cannot be negative.");return a<=e?"Circular":a<1-e?"Elliptical":a<=1+e?"Parabolic":"Hyperbolic"}function meanAnomalyToTrueAnomaly(a,e){if(e<0||e>=1)throw new DeveloperError("eccentricity out of range.");return eccentricAnomalyToTrueAnomaly(meanAnomalyToEccentricAnomaly(a,e),e)}var maxIterationCount=50,keplerEqConvergence=CesiumMath.EPSILON8;function meanAnomalyToEccentricAnomaly(a,e){if(e<0||e>=1)throw new DeveloperError("eccentricity out of range.");var t,n=Math.floor(a/CesiumMath.TWO_PI),r=(a-=n*CesiumMath.TWO_PI)+e*Math.sin(a)/(1-Math.sin(a+e)+Math.sin(a)),o=Number.MAX_VALUE;for(t=0;t<maxIterationCount&&Math.abs(o-r)>keplerEqConvergence;++t)r=(o=r)-(o-e*Math.sin(o)-a)/(1-e*Math.cos(o));if(t>=maxIterationCount)throw new DeveloperError("Kepler equation did not converge");return r+n*CesiumMath.TWO_PI}function eccentricAnomalyToTrueAnomaly(a,e){if(e<0||e>=1)throw new DeveloperError("eccentricity out of range.");var t=Math.floor(a/CesiumMath.TWO_PI);a-=t*CesiumMath.TWO_PI;var n=Math.cos(a)-e,r=Math.sin(a)*Math.sqrt(1-e*e),o=Math.atan2(r,n);return o=CesiumMath.zeroToTwoPi(o),a<0&&(o-=CesiumMath.TWO_PI),o+t*CesiumMath.TWO_PI}function perifocalToCartesianMatrix(a,e,t,n){if(e<0||e>CesiumMath.PI)throw new DeveloperError("inclination out of range");var r=Math.cos(a),o=Math.sin(a),i=Math.cos(e),s=Math.sin(e),c=Math.cos(t),M=Math.sin(t);return defined(n)?(n[0]=c*r-M*o*i,n[1]=M*r+c*o*i,n[2]=o*s,n[3]=-c*o-M*r*i,n[4]=-M*o+c*r*i,n[5]=r*s,n[6]=M*s,n[7]=-c*s,n[8]=i):n=new Matrix3(c*r-M*o*i,-c*o-M*r*i,M*s,M*r+c*o*i,-M*o+c*r*i,-c*s,o*s,r*s,i),n}var semiMajorAxis0=1.0000010178*MetersPerAstronomicalUnit,meanLongitude0=100.46645683*RadiansPerDegree,meanLongitude1=1295977422.83429*RadiansPerArcSecond,p1u=16002,p2u=21863,p3u=32004,p4u=10931,p5u=14529,p6u=16368,p7u=15318,p8u=32794,Ca1=64*1e-7*MetersPerAstronomicalUnit,Ca2=1e-7*-152*MetersPerAstronomicalUnit,Ca3=62*1e-7*MetersPerAstronomicalUnit,Ca4=-8e-7*MetersPerAstronomicalUnit,Ca5=32*1e-7*MetersPerAstronomicalUnit,Ca6=1e-7*-41*MetersPerAstronomicalUnit,Ca7=19*1e-7*MetersPerAstronomicalUnit,Ca8=1e-7*-11*MetersPerAstronomicalUnit,Sa1=1e-7*-150*MetersPerAstronomicalUnit,Sa2=1e-7*-46*MetersPerAstronomicalUnit,Sa3=68*1e-7*MetersPerAstronomicalUnit,Sa4=54*1e-7*MetersPerAstronomicalUnit,Sa5=14*1e-7*MetersPerAstronomicalUnit,Sa6=24*1e-7*MetersPerAstronomicalUnit,Sa7=1e-7*-28*MetersPerAstronomicalUnit,Sa8=22*1e-7*MetersPerAstronomicalUnit,q1u=10,q2u=16002,q3u=21863,q4u=10931,q5u=1473,q6u=32004,q7u=4387,q8u=73,Cl1=1e-7*-325,Cl2=1e-7*-322,Cl3=1e-7*-79,Cl4=232*1e-7,Cl5=1e-7*-52,Cl6=97*1e-7,Cl7=55*1e-7,Cl8=1e-7*-41,Sl1=1e-7*-105,Sl2=1e-7*-137,Sl3=258*1e-7,Sl4=35*1e-7,Sl5=1e-7*-116,Sl6=1e-7*-88,Sl7=1e-7*-112,Sl8=1e-7*-80,scratchDate=new JulianDate(0,0,TimeStandard.TAI);function computeSimonEarthMoonBarycenter(a,e){taiToTdb(a,scratchDate);var t=(scratchDate.dayNumber-epoch.dayNumber+(scratchDate.secondsOfDay-epoch.secondsOfDay)/TimeConstants.SECONDS_PER_DAY)/(10*TimeConstants.DAYS_PER_JULIAN_CENTURY),n=.3595362*t,r=semiMajorAxis0+Ca1*Math.cos(p1u*n)+Sa1*Math.sin(p1u*n)+Ca2*Math.cos(p2u*n)+Sa2*Math.sin(p2u*n)+Ca3*Math.cos(p3u*n)+Sa3*Math.sin(p3u*n)+Ca4*Math.cos(p4u*n)+Sa4*Math.sin(p4u*n)+Ca5*Math.cos(p5u*n)+Sa5*Math.sin(p5u*n)+Ca6*Math.cos(p6u*n)+Sa6*Math.sin(p6u*n)+Ca7*Math.cos(p7u*n)+Sa7*Math.sin(p7u*n)+Ca8*Math.cos(p8u*n)+Sa8*Math.sin(p8u*n),o=meanLongitude0+meanLongitude1*t+Cl1*Math.cos(q1u*n)+Sl1*Math.sin(q1u*n)+Cl2*Math.cos(q2u*n)+Sl2*Math.sin(q2u*n)+Cl3*Math.cos(q3u*n)+Sl3*Math.sin(q3u*n)+Cl4*Math.cos(q4u*n)+Sl4*Math.sin(q4u*n)+Cl5*Math.cos(q5u*n)+Sl5*Math.sin(q5u*n)+Cl6*Math.cos(q6u*n)+Sl6*Math.sin(q6u*n)+Cl7*Math.cos(q7u*n)+Sl7*Math.sin(q7u*n)+Cl8*Math.cos(q8u*n)+Sl8*Math.sin(q8u*n);return elementsToCartesian(r,.0167086342-.0004203654*t,469.97289*RadiansPerArcSecond*t,102.93734808*RadiansPerDegree+11612.3529*RadiansPerArcSecond*t,174.87317577*RadiansPerDegree-8679.27034*RadiansPerArcSecond*t,o,e)}function computeSimonMoon(a,e){taiToTdb(a,scratchDate);var t=(scratchDate.dayNumber-epoch.dayNumber+(scratchDate.secondsOfDay-epoch.secondsOfDay)/TimeConstants.SECONDS_PER_DAY)/TimeConstants.DAYS_PER_JULIAN_CENTURY,n=t*t,r=n*t,o=r*t,i=383397.7725+.004*t,s=.055545526-16e-9*t,c=5.15668983*RadiansPerDegree,M=-8e-5*t+.02966*n-42e-6*r-13e-8*o,h=83.35324312*RadiansPerDegree,u=14643420.2669*t-38.2702*n-.045047*r+21301e-8*o,l=125.04455501*RadiansPerDegree,m=-6967919.3631*t+6.3602*n+.007625*r-3586e-8*o,d=218.31664563*RadiansPerDegree,p=1732559343.4847*t-6.391*n+.006588*r-3169e-8*o,C=297.85019547*RadiansPerDegree+RadiansPerArcSecond*(1602961601.209*t-6.3706*n+.006593*r-3169e-8*o),P=134.96340251*RadiansPerDegree+RadiansPerArcSecond*(1717915923.2178*t+31.8792*n+.051635*r-2447e-7*o),S=357.52910918*RadiansPerDegree+RadiansPerArcSecond*(129596581.0481*t-.5532*n+136e-6*r-1149e-8*o),f=310.17137918*RadiansPerDegree-RadiansPerArcSecond*(6967051.436*t+6.2068*n+.007618*r-3219e-8*o),A=2*C,T=4*C,D=6*C,y=2*P,E=3*P,R=4*P,v=2*(93.27209062*RadiansPerDegree+RadiansPerArcSecond*(1739527262.8478*t-12.7512*n-.001037*r+417e-8*o));i+=3400.4*Math.cos(A)-635.6*Math.cos(A-P)-235.6*Math.cos(P)+218.1*Math.cos(A-S)+181*Math.cos(A+P),s+=.014216*Math.cos(A-P)+.008551*Math.cos(A-y)-.001383*Math.cos(P)+.001356*Math.cos(A+P)-.001147*Math.cos(T-E)-914e-6*Math.cos(T-y)+869e-6*Math.cos(A-S-P)-627e-6*Math.cos(A)-394e-6*Math.cos(T-R)+282e-6*Math.cos(A-S-y)-279e-6*Math.cos(C-P)-236e-6*Math.cos(y)+231e-6*Math.cos(T)+229e-6*Math.cos(D-R)-201e-6*Math.cos(y-v),M+=486.26*Math.cos(A-v)-40.13*Math.cos(A)+37.51*Math.cos(v)+25.73*Math.cos(y-v)+19.97*Math.cos(A-S-v),u+=-55609*Math.sin(A-P)-34711*Math.sin(A-y)-9792*Math.sin(P)+9385*Math.sin(T-E)+7505*Math.sin(T-y)+5318*Math.sin(A+P)+3484*Math.sin(T-R)-3417*Math.sin(A-S-P)-2530*Math.sin(D-R)-2376*Math.sin(A)-2075*Math.sin(A-E)-1883*Math.sin(y)-1736*Math.sin(D-5*P)+1626*Math.sin(S)-1370*Math.sin(D-E),m+=-5392*Math.sin(A-v)-540*Math.sin(S)-441*Math.sin(A)+423*Math.sin(v)-288*Math.sin(y-v),p+=-3332.9*Math.sin(A)+1197.4*Math.sin(A-P)-662.5*Math.sin(S)+396.3*Math.sin(P)-218*Math.sin(A-S);var q=2*f,g=3*f;M+=46.997*Math.cos(f)*t-.614*Math.cos(A-v+f)*t+.614*Math.cos(A-v-f)*t-.0297*Math.cos(q)*n-.0335*Math.cos(f)*n+.0012*Math.cos(A-v+q)*n-16e-5*Math.cos(f)*r+4e-5*Math.cos(g)*r+4e-5*Math.cos(q)*r;var w=2.116*Math.sin(f)*t-.111*Math.sin(A-v-f)*t-.0015*Math.sin(f)*n;return u+=w,p+=w,m+=-520.77*Math.sin(f)*t+13.66*Math.sin(A-v+f)*t+1.12*Math.sin(A-f)*t-1.06*Math.sin(v-f)*t+.66*Math.sin(q)*n+.371*Math.sin(f)*n-.035*Math.sin(A-v+q)*n-.015*Math.sin(A-v+f)*n+.0014*Math.sin(f)*r-.0011*Math.sin(g)*r-9e-4*Math.sin(q)*r,elementsToCartesian(i*=MetersPerKilometer,s,c+M*RadiansPerArcSecond,h+u*RadiansPerArcSecond,l+m*RadiansPerArcSecond,d+p*RadiansPerArcSecond,e)}var moonEarthMassRatio=.012300034,factor=moonEarthMassRatio/(moonEarthMassRatio+1)*-1;function computeSimonEarth(a,e){return e=computeSimonMoon(a,e),Cartesian3.multiplyByScalar(e,factor,e)}var axesTransformation=new Matrix3(1.0000000000000002,5619723173785822e-31,4690511510146299e-34,-5154129427414611e-31,.9174820620691819,-.39777715593191376,-223970096136568e-30,.39777715593191376,.9174820620691819),translation=new Cartesian3;Simon1994PlanetaryPositions.computeSunPositionInEarthInertialFrame=function(a,e){return defined(a)||(a=JulianDate.now()),defined(e)||(e=new Cartesian3),translation=computeSimonEarthMoonBarycenter(a,translation),e=Cartesian3.negate(translation,e),computeSimonEarth(a,translation),Cartesian3.subtract(e,translation,e),Matrix3.multiplyByVector(axesTransformation,e,e),e},Simon1994PlanetaryPositions.computeMoonPositionInEarthInertialFrame=function(a,e){return defined(a)||(a=JulianDate.now()),e=computeSimonMoon(a,e),Matrix3.multiplyByVector(axesTransformation,e,e),e};export default Simon1994PlanetaryPositions;