import defaultValue from"./defaultValue.js";import defined from"./defined.js";import DeveloperError from"./DeveloperError.js";var Tipsify={calculateACMR:function(e){var r=(e=defaultValue(e,defaultValue.EMPTY_OBJECT)).indices,i=e.maximumIndex,t=defaultValue(e.cacheSize,24);if(!defined(r))throw new DeveloperError("indices is required.");var n=r.length;if(n<3||n%3!=0)throw new DeveloperError("indices length must be a multiple of three.");if(i<=0)throw new DeveloperError("maximumIndex must be greater than zero.");if(t<3)throw new DeveloperError("cacheSize must be greater than two.");if(!defined(i)){i=0;for(var a=0,l=r[a];a<n;)l>i&&(i=l),l=r[++a]}for(var o=[],u=0;u<i+1;u++)o[u]=0;for(var f=t+1,m=0;m<n;++m)f-o[r[m]]>t&&(o[r[m]]=f,++f);return(f-t+1)/(n/3)},tipsify:function(e){var r,i=(e=defaultValue(e,defaultValue.EMPTY_OBJECT)).indices,t=e.maximumIndex,n=defaultValue(e.cacheSize,24);function a(e,i,t,n,a,l,o){for(var u,f=-1,m=-1,v=0;v<t.length;){var s=t[v];n[s].numLiveTriangles&&(u=0,a-n[s].timeStamp+2*n[s].numLiveTriangles<=i&&(u=a-n[s].timeStamp),(u>m||-1===m)&&(m=u,f=s)),++v}return-1===f?function(e,i,t,n){for(;i.length>=1;){var a=i[i.length-1];if(i.splice(i.length-1,1),e[a].numLiveTriangles>0)return a}for(;r<n;){if(e[r].numLiveTriangles>0)return++r-1;++r}return-1}(n,l,0,o):f}if(!defined(i))throw new DeveloperError("indices is required.");var l=i.length;if(l<3||l%3!=0)throw new DeveloperError("indices length must be a multiple of three.");if(t<=0)throw new DeveloperError("maximumIndex must be greater than zero.");if(n<3)throw new DeveloperError("cacheSize must be greater than two.");var o=0,u=0,f=i[u],m=l;if(defined(t))o=t+1;else{for(;u<m;)f>o&&(o=f),f=i[++u];if(-1===o)return 0;++o}var v,s=[];for(v=0;v<o;v++)s[v]={numLiveTriangles:0,timeStamp:0,vertexTriangles:[]};u=0;for(var d=0;u<m;)s[i[u]].vertexTriangles.push(d),++s[i[u]].numLiveTriangles,s[i[u+1]].vertexTriangles.push(d),++s[i[u+1]].numLiveTriangles,s[i[u+2]].vertexTriangles.push(d),++s[i[u+2]].numLiveTriangles,++d,u+=3;var h=0,p=n+1;r=1;var g,c,T,w,x=[],E=[],D=0,L=[],S=l/3,V=[];for(v=0;v<S;v++)V[v]=!1;for(;-1!==h;){x=[],w=(c=s[h]).vertexTriangles.length;for(var b=0;b<w;++b)if(!V[d=c.vertexTriangles[b]]){V[d]=!0,u=d+d+d;for(var z=0;z<3;++z)T=i[u],x.push(T),E.push(T),L[D]=T,++D,--(g=s[T]).numLiveTriangles,p-g.timeStamp>n&&(g.timeStamp=p,++p),++u}h=a(0,n,x,s,p,E,o)}return L}};export default Tipsify;