import arrayFill from"./arrayFill.js";import BoundingSphere from"./BoundingSphere.js";import Cartesian3 from"./Cartesian3.js";import Cartographic from"./Cartographic.js";import ComponentDatatype from"./ComponentDatatype.js";import defaultValue from"./defaultValue.js";import defined from"./defined.js";import DeveloperError from"./DeveloperError.js";import Ellipsoid from"./Ellipsoid.js";import Geometry from"./Geometry.js";import GeometryAttribute from"./GeometryAttribute.js";import GeometryAttributes from"./GeometryAttributes.js";import GeometryOffsetAttribute from"./GeometryOffsetAttribute.js";import IndexDatatype from"./IndexDatatype.js";import CesiumMath from"./Math.js";import PolygonPipeline from"./PolygonPipeline.js";import PrimitiveType from"./PrimitiveType.js";import Rectangle from"./Rectangle.js";import RectangleGeometryLibrary from"./RectangleGeometryLibrary.js";var bottomBoundingSphere=new BoundingSphere,topBoundingSphere=new BoundingSphere,positionScratch=new Cartesian3,rectangleScratch=new Rectangle;function constructRectangle(e,t){var r=e._ellipsoid,i=t.height,o=t.width,a=t.northCap,n=t.southCap,l=i,s=2,u=0,c=4;a&&(s-=1,l-=1,u+=1,c-=2),n&&(s-=1,l-=1,u+=1,c-=2),u+=s*o+2*l-c;var p,d=new Float64Array(3*u),g=0,h=0,f=positionScratch;if(a)RectangleGeometryLibrary.computePosition(t,r,!1,h,0,f),d[g++]=f.x,d[g++]=f.y,d[g++]=f.z;else for(p=0;p<o;p++)RectangleGeometryLibrary.computePosition(t,r,!1,h,p,f),d[g++]=f.x,d[g++]=f.y,d[g++]=f.z;for(p=o-1,h=1;h<i;h++)RectangleGeometryLibrary.computePosition(t,r,!1,h,p,f),d[g++]=f.x,d[g++]=f.y,d[g++]=f.z;if(h=i-1,!n)for(p=o-2;p>=0;p--)RectangleGeometryLibrary.computePosition(t,r,!1,h,p,f),d[g++]=f.x,d[g++]=f.y,d[g++]=f.z;for(p=0,h=i-2;h>0;h--)RectangleGeometryLibrary.computePosition(t,r,!1,h,p,f),d[g++]=f.x,d[g++]=f.y,d[g++]=f.z;for(var m=d.length/3*2,y=IndexDatatype.createTypedArray(d.length/3,m),v=0,b=0;b<d.length/3-1;b++)y[v++]=b,y[v++]=b+1;y[v++]=d.length/3-1,y[v++]=0;var E=new Geometry({attributes:new GeometryAttributes,primitiveType:PrimitiveType.LINES});return E.attributes.position=new GeometryAttribute({componentDatatype:ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:d}),E.indices=y,E}function constructExtrudedRectangle(e,t){var r=e._surfaceHeight,i=e._extrudedHeight,o=e._ellipsoid,a=i,n=r,l=constructRectangle(e,t),s=t.height,u=t.width,c=PolygonPipeline.scaleToGeodeticHeight(l.attributes.position.values,n,o,!1),p=c.length,d=new Float64Array(2*p);d.set(c);var g=PolygonPipeline.scaleToGeodeticHeight(l.attributes.position.values,a,o);d.set(g,p),l.attributes.position.values=d;var h=t.northCap,f=t.southCap,m=4;h&&(m-=1),f&&(m-=1);var y=2*(d.length/3+m),v=IndexDatatype.createTypedArray(d.length/3,y);p=d.length/6;for(var b,E=0,_=0;_<p-1;_++)v[E++]=_,v[E++]=_+1,v[E++]=_+p,v[E++]=_+p+1;if(v[E++]=p-1,v[E++]=0,v[E++]=p+p-1,v[E++]=p,v[E++]=0,v[E++]=p,h)b=s-1;else{var R=u-1;v[E++]=R,v[E++]=R+p,b=u+s-2}if(v[E++]=b,v[E++]=b+p,!f){var G=u+b-1;v[E++]=G,v[E]=G+p}return l.indices=v,l}function RectangleOutlineGeometry(e){var t=(e=defaultValue(e,defaultValue.EMPTY_OBJECT)).rectangle,r=defaultValue(e.granularity,CesiumMath.RADIANS_PER_DEGREE),i=defaultValue(e.ellipsoid,Ellipsoid.WGS84),o=defaultValue(e.rotation,0);if(!defined(t))throw new DeveloperError("rectangle is required.");if(Rectangle.validate(t),t.north<t.south)throw new DeveloperError("options.rectangle.north must be greater than options.rectangle.south");var a=defaultValue(e.height,0),n=defaultValue(e.extrudedHeight,a);this._rectangle=Rectangle.clone(t),this._granularity=r,this._ellipsoid=i,this._surfaceHeight=Math.max(a,n),this._rotation=o,this._extrudedHeight=Math.min(a,n),this._offsetAttribute=e.offsetAttribute,this._workerName="createRectangleOutlineGeometry"}RectangleOutlineGeometry.packedLength=Rectangle.packedLength+Ellipsoid.packedLength+5,RectangleOutlineGeometry.pack=function(e,t,r){if(!defined(e))throw new DeveloperError("value is required");if(!defined(t))throw new DeveloperError("array is required");return r=defaultValue(r,0),Rectangle.pack(e._rectangle,t,r),r+=Rectangle.packedLength,Ellipsoid.pack(e._ellipsoid,t,r),r+=Ellipsoid.packedLength,t[r++]=e._granularity,t[r++]=e._surfaceHeight,t[r++]=e._rotation,t[r++]=e._extrudedHeight,t[r]=defaultValue(e._offsetAttribute,-1),t};var scratchRectangle=new Rectangle,scratchEllipsoid=Ellipsoid.clone(Ellipsoid.UNIT_SPHERE),scratchOptions={rectangle:scratchRectangle,ellipsoid:scratchEllipsoid,granularity:void 0,height:void 0,rotation:void 0,extrudedHeight:void 0,offsetAttribute:void 0};RectangleOutlineGeometry.unpack=function(e,t,r){if(!defined(e))throw new DeveloperError("array is required");t=defaultValue(t,0);var i=Rectangle.unpack(e,t,scratchRectangle);t+=Rectangle.packedLength;var o=Ellipsoid.unpack(e,t,scratchEllipsoid);t+=Ellipsoid.packedLength;var a=e[t++],n=e[t++],l=e[t++],s=e[t++],u=e[t];return defined(r)?(r._rectangle=Rectangle.clone(i,r._rectangle),r._ellipsoid=Ellipsoid.clone(o,r._ellipsoid),r._surfaceHeight=n,r._rotation=l,r._extrudedHeight=s,r._offsetAttribute=-1===u?void 0:u,r):(scratchOptions.granularity=a,scratchOptions.height=n,scratchOptions.rotation=l,scratchOptions.extrudedHeight=s,scratchOptions.offsetAttribute=-1===u?void 0:u,new RectangleOutlineGeometry(scratchOptions))};var nwScratch=new Cartographic;RectangleOutlineGeometry.createGeometry=function(e){var t,r,i=e._rectangle,o=e._ellipsoid,a=RectangleGeometryLibrary.computeOptions(i,e._granularity,e._rotation,0,rectangleScratch,nwScratch);if(!CesiumMath.equalsEpsilon(i.north,i.south,CesiumMath.EPSILON10)&&!CesiumMath.equalsEpsilon(i.east,i.west,CesiumMath.EPSILON10)){var n,l=e._surfaceHeight,s=e._extrudedHeight;if(CesiumMath.equalsEpsilon(l,s,0,CesiumMath.EPSILON2)){if((t=constructRectangle(e,a)).attributes.position.values=PolygonPipeline.scaleToGeodeticHeight(t.attributes.position.values,l,o,!1),defined(e._offsetAttribute)){var u=t.attributes.position.values.length,c=new Uint8Array(u/3);n=e._offsetAttribute===GeometryOffsetAttribute.NONE?0:1,arrayFill(c,n),t.attributes.applyOffset=new GeometryAttribute({componentDatatype:ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:c})}r=BoundingSphere.fromRectangle3D(i,o,l)}else{if(t=constructExtrudedRectangle(e,a),defined(e._offsetAttribute)){var p=t.attributes.position.values.length/3,d=new Uint8Array(p);e._offsetAttribute===GeometryOffsetAttribute.TOP?d=arrayFill(d,1,0,p/2):(n=e._offsetAttribute===GeometryOffsetAttribute.NONE?0:1,d=arrayFill(d,n)),t.attributes.applyOffset=new GeometryAttribute({componentDatatype:ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:d})}var g=BoundingSphere.fromRectangle3D(i,o,l,topBoundingSphere),h=BoundingSphere.fromRectangle3D(i,o,s,bottomBoundingSphere);r=BoundingSphere.union(g,h)}return new Geometry({attributes:t.attributes,indices:t.indices,primitiveType:PrimitiveType.LINES,boundingSphere:r,offsetAttribute:e._offsetAttribute})}};export default RectangleOutlineGeometry;